# 18.2 AIç¼–ç¨‹åŠ©æ‰‹ï¼šCursoræ™ºèƒ½ä½“

> **è®¾è®¡æ€æƒ³**ï¼šAIç¼–ç¨‹åŠ©æ‰‹ä¸æ˜¯æ›¿ä»£ç¨‹åºå‘˜,è€Œæ˜¯æˆä¸ºç¨‹åºå‘˜æœ€å¥½çš„æ­æ¡£ã€‚é€šè¿‡å¤šæ™ºèƒ½ä½“åä½œ,è®©AIç†è§£ä»£ç ã€ç”Ÿæˆä»£ç ã€å®¡æŸ¥ä»£ç ,æ„å»ºå®Œæ•´çš„ç¼–ç¨‹è¾…åŠ©ç”Ÿæ€ã€‚

## å¼•è¨€ï¼šä»IDEåˆ°AI-DE

è¿˜è®°å¾—ç¬¬ä¸€æ¬¡ä½¿ç”¨IDEçš„æ„Ÿå—å—ï¼Ÿè‡ªåŠ¨è¡¥å…¨ã€è¯­æ³•æ£€æŸ¥ã€å¿«é€Ÿé‡æ„...è¿™äº›åŠŸèƒ½æå¤§æå‡äº†å¼€å‘æ•ˆç‡ã€‚ç°åœ¨,**AIé©±åŠ¨çš„ç¼–ç¨‹åŠ©æ‰‹**å°†è¿™ä¸€åˆ‡æå‡åˆ°äº†æ–°çš„é«˜åº¦ï¼š

```mermaid
graph LR
    A[ä¼ ç»ŸIDE] -->|è¿›åŒ–| B[AI-DE]
    
    A --> A1[è¯­æ³•é«˜äº®]
    A --> A2[ä»£ç è¡¥å…¨]
    A --> A3[é”™è¯¯æ£€æŸ¥]
    
    B --> B1[æ™ºèƒ½ç†è§£]
    B --> B2[ä»£ç ç”Ÿæˆ]
    B --> B3[è‡ªåŠ¨é‡æ„]
    B --> B4[æµ‹è¯•ç”Ÿæˆ]
    B --> B5[æ–‡æ¡£ç”Ÿæˆ]
    
    style A fill:#e1f5ff
    style B fill:#51cf66
```

**Cursor** æ˜¯è¿™ä¸ªé¢†åŸŸçš„ä½¼ä½¼è€…ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†å‰–æå®ƒçš„æ ¸å¿ƒè®¾è®¡,å¹¶ç”¨Javaå®ç°ä¸€ä¸ªç±»ä¼¼çš„å¤šæ™ºèƒ½ä½“ç¼–ç¨‹åŠ©æ‰‹ç³»ç»Ÿã€‚

## å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬èŠ‚å­¦ä¹ å,ä½ å°†èƒ½å¤Ÿï¼š

- âœ… **è®¾è®¡ç¼–ç¨‹åŠ©æ‰‹æ¶æ„** - ç†è§£AIç¼–ç¨‹åŠ©æ‰‹çš„æ ¸å¿ƒç»„ä»¶è®¾è®¡
- âœ… **å®ç°ä»£ç ç†è§£** - æ„å»ºèƒ½ç†è§£ä»£ç è¯­ä¹‰çš„æ™ºèƒ½ä½“
- âœ… **å¼€å‘ä»£ç ç”Ÿæˆ** - å®ç°æ™ºèƒ½ä»£ç ç”Ÿæˆå’Œé‡æ„
- âœ… **æ„å»ºä»£ç å®¡æŸ¥** - å¼€å‘è‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥ç³»ç»Ÿ
- âœ… **æŒæ¡æ™ºèƒ½ä½“åä½œ** - è®©å¤šä¸ªæ™ºèƒ½ä½“ååŒå·¥ä½œ

---

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1. æ•´ä½“æ¶æ„

ä¸€ä¸ªå®Œæ•´çš„AIç¼–ç¨‹åŠ©æ‰‹éœ€è¦å¤šä¸ªä¸“é—¨æ™ºèƒ½ä½“çš„åä½œï¼š

```mermaid
graph TB
    User[ğŸ‘¨â€ğŸ’» å¼€å‘è€…]
    
    User --> Orchestrator[ğŸ¯ ç¼–æ’æ™ºèƒ½ä½“<br/>Orchestrator]
    
    Orchestrator --> Understanding[ğŸ” ä»£ç ç†è§£æ™ºèƒ½ä½“<br/>Code Understanding]
    Orchestrator --> Generation[âœ¨ ä»£ç ç”Ÿæˆæ™ºèƒ½ä½“<br/>Code Generation]
    Orchestrator --> Review[ğŸ” ä»£ç å®¡æŸ¥æ™ºèƒ½ä½“<br/>Code Review]
    Orchestrator --> Testing[ğŸ§ª æµ‹è¯•ç”Ÿæˆæ™ºèƒ½ä½“<br/>Test Generation]
    
    Understanding --> KB[(çŸ¥è¯†åº“<br/>Knowledge Base)]
    Generation --> KB
    Review --> KB
    Testing --> KB
    
    KB --> LLM[ğŸ¤– å¤§è¯­è¨€æ¨¡å‹<br/>LLM Service]
    
    style Orchestrator fill:#ff6b6b,color:#fff
    style Understanding fill:#339af0
    style Generation fill:#51cf66
    style Review fill:#ffd43b
    style Testing fill:#a855f7
    style KB fill:#f1f8e9
    style LLM fill:#ffe0e0
```

**æ¶æ„äº®ç‚¹**ï¼š
- **ç¼–æ’æ™ºèƒ½ä½“**ï¼šä¸­å¤®åè°ƒå™¨,è´Ÿè´£ä»»åŠ¡åˆ†å‘
- **ä¸“ä¸šæ™ºèƒ½ä½“**ï¼šå„å¸å…¶èŒ,ä¸“æ³¨ç‰¹å®šé¢†åŸŸ
- **çŸ¥è¯†åº“**ï¼šå…±äº«ä»£ç çŸ¥è¯†å’Œä¸Šä¸‹æ–‡
- **LLMæœåŠ¡**ï¼šç»Ÿä¸€çš„AIèƒ½åŠ›æ¥å£

### 2. æ ¸å¿ƒæ™ºèƒ½ä½“èŒè´£

| æ™ºèƒ½ä½“ | æ ¸å¿ƒèƒ½åŠ› | è¾“å…¥ | è¾“å‡º |
|--------|---------|------|------|
| **ä»£ç ç†è§£** | ASTè§£æã€è¯­ä¹‰åˆ†æ | æºä»£ç  | ä»£ç ç»“æ„ã€ä¾èµ–å…³ç³» |
| **ä»£ç ç”Ÿæˆ** | æ™ºèƒ½è¡¥å…¨ã€ä»£ç ç”Ÿæˆ | éœ€æ±‚æè¿° | ä»£ç å®ç° |
| **ä»£ç å®¡æŸ¥** | è´¨é‡æ£€æŸ¥ã€æœ€ä½³å®è·µ | ä»£ç å˜æ›´ | é—®é¢˜æŠ¥å‘Šã€æ”¹è¿›å»ºè®® |
| **æµ‹è¯•ç”Ÿæˆ** | ç”¨ä¾‹ç”Ÿæˆã€è¦†ç›–åˆ†æ | åŠŸèƒ½ä»£ç  | æµ‹è¯•ä»£ç  |

---

## ä¸€ã€ä»£ç ç†è§£æ™ºèƒ½ä½“

### 1. æ ¸å¿ƒåŠŸèƒ½

ä»£ç ç†è§£æ™ºèƒ½ä½“æ˜¯æ•´ä¸ªç³»ç»Ÿçš„åŸºç¡€,å®ƒéœ€è¦ï¼š

```mermaid
graph LR
    Code[æºä»£ç ] --> Parse[è¯­æ³•è§£æ]
    Parse --> AST[æŠ½è±¡è¯­æ³•æ ‘]
    AST --> Semantic[è¯­ä¹‰åˆ†æ]
    Semantic --> Context[ä¸Šä¸‹æ–‡ç†è§£]
    Context --> Knowledge[çŸ¥è¯†æå–]
    
    style Code fill:#e1f5ff
    style AST fill:#fff3e0
    style Knowledge fill:#f1f8e9
```

### 2. å…³é”®å®ç°

```java
public class CodeUnderstandingAgent extends Agent {
    private CodeParser parser;           // ä»£ç è§£æå™¨
    private SemanticAnalyzer analyzer;   // è¯­ä¹‰åˆ†æå™¨
    private KnowledgeBase kb;            // çŸ¥è¯†åº“
    
    @Override
    public AgentResponse processMessage(AgentMessage message) {
        CodeAnalysisRequest request = (CodeAnalysisRequest) message.getContent();
        
        // 1. è§£æä»£ç ç»“æ„
        CodeAST ast = parser.parse(request.getCode());
        
        // 2. è¯­ä¹‰åˆ†æ
        SemanticInfo semantics = analyzer.analyze(ast);
        
        // 3. å­˜å‚¨åˆ°çŸ¥è¯†åº“
        kb.store(request.getFileId(), ast, semantics);
        
        // 4. è¿”å›åˆ†æç»“æœ
        return createResponse(ast, semantics);
    }
}
```

### 3. ä»£ç è§£æç¤ºä¾‹

ä»¥ä¸‹æ˜¯è§£æJavaæ–¹æ³•çš„ç¤ºä¾‹ï¼š

```java
// è¾“å…¥ä»£ç 
public int calculateSum(List<Integer> numbers) {
    return numbers.stream()
                 .mapToInt(Integer::intValue)
                 .sum();
}

// è§£æç»“æœï¼ˆç®€åŒ–ï¼‰
CodeAST {
    type: METHOD,
    name: "calculateSum",
    returnType: "int",
    parameters: [
        { name: "numbers", type: "List<Integer>" }
    ],
    body: {
        type: STREAM_OPERATION,
        operations: ["stream", "mapToInt", "sum"]
    }
}
```

### 4. è¯­ä¹‰åˆ†æç»“æœ

```mermaid
graph TB
    Method[calculateSumæ–¹æ³•]
    
    Method --> Purpose[ç›®çš„ï¼šè®¡ç®—æ•´æ•°åˆ—è¡¨æ€»å’Œ]
    Method --> Input[è¾“å…¥ï¼šæ•´æ•°åˆ—è¡¨]
    Method --> Output[è¾“å‡ºï¼šæ€»å’Œå€¼]
    Method --> Pattern[æ¨¡å¼ï¼šStream API]
    Method --> Complexity[å¤æ‚åº¦ï¼šO n]
    
    style Method fill:#339af0,color:#fff
    style Purpose fill:#51cf66
```

---

## äºŒã€ä»£ç ç”Ÿæˆæ™ºèƒ½ä½“

### 1. å·¥ä½œæµç¨‹

ä»£ç ç”Ÿæˆæ˜¯æœ€ç›´è§‚çš„AIèƒ½åŠ›ï¼š

```mermaid
sequenceDiagram
    participant User as ğŸ‘¨â€ğŸ’» ç”¨æˆ·
    participant Gen as ä»£ç ç”Ÿæˆæ™ºèƒ½ä½“
    participant Under as ä»£ç ç†è§£æ™ºèƒ½ä½“
    participant LLM as ğŸ¤– LLM
    
    User->>Gen: éœ€æ±‚æè¿°<br/>"å®ç°ç”¨æˆ·ç™»å½•"
    Gen->>Under: æŸ¥è¯¢ç›¸å…³ä¸Šä¸‹æ–‡
    Under-->>Gen: ç°æœ‰ä»£ç ç»“æ„
    Gen->>LLM: ç”Ÿæˆè¯·æ±‚
    LLM-->>Gen: ä»£ç å»ºè®®
    Gen->>Gen: åå¤„ç†ä¼˜åŒ–
    Gen-->>User: ç”Ÿæˆä»£ç 
```

### 2. æ ¸å¿ƒå®ç°

```java
public class CodeGenerationAgent extends Agent {
    private LLMService llmService;
    private CodeFormatter formatter;
    private ContextBuilder contextBuilder;
    
    public GeneratedCode generateCode(GenerationRequest request) {
        // 1. æ„å»ºä¸Šä¸‹æ–‡
        CodeContext context = contextBuilder.build(
            request.getCurrentFile(),
            request.getCursorPosition()
        );
        
        // 2. å‡†å¤‡æç¤ºè¯
        String prompt = buildPrompt(
            request.getDescription(),
            context
        );
        
        // 3. è°ƒç”¨LLM
        String rawCode = llmService.complete(prompt);
        
        // 4. æ ¼å¼åŒ–å’Œä¼˜åŒ–
        return formatter.format(rawCode, context.getCodeStyle());
    }
    
    private String buildPrompt(String description, CodeContext context) {
        return String.format("""
            # ä»»åŠ¡
            %s
            
            # å½“å‰ä»£ç ä¸Šä¸‹æ–‡
            ```java
            %s
            ```
            
            # é¡¹ç›®ä¾èµ–
            %s
            
            # ä»£ç é£æ ¼
            %s
            
            è¯·ç”Ÿæˆç¬¦åˆä¸Šè¿°è¦æ±‚çš„Javaä»£ç ã€‚
            """,
            description,
            context.getSurroundingCode(),
            context.getDependencies(),
            context.getCodeStyle()
        );
    }
}
```

### 3. ç”Ÿæˆç¤ºä¾‹

**ç”¨æˆ·è¾“å…¥**ï¼š
```
// éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼
```

**AIç”Ÿæˆ**ï¼š
```java
public class Singleton {
    private static volatile Singleton instance;
    private static final Object lock = new Object();
    
    private Singleton() {
        // ç§æœ‰æ„é€ å‡½æ•°
    }
    
    public static Singleton getInstance() {
        if (instance == null) {
            synchronized (lock) {
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}
```

**è®¾è®¡äº®ç‚¹**ï¼š
- âœ… åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼
- âœ… volatileå…³é”®å­—ä¿è¯å¯è§æ€§
- âœ… ç¬¦åˆJavaä»£ç è§„èŒƒ

---

## ä¸‰ã€ä»£ç å®¡æŸ¥æ™ºèƒ½ä½“

### 1. å®¡æŸ¥ç»´åº¦

ä»£ç å®¡æŸ¥æ™ºèƒ½ä½“ä»å¤šä¸ªç»´åº¦æ£€æŸ¥ä»£ç è´¨é‡ï¼š

```mermaid
graph TB
    Code[å¾…å®¡æŸ¥ä»£ç ]
    
    Code --> Quality[ä»£ç è´¨é‡]
    Code --> Security[å®‰å…¨æ£€æŸ¥]
    Code --> Performance[æ€§èƒ½åˆ†æ]
    Code --> Style[ä»£ç é£æ ¼]
    Code --> Best[æœ€ä½³å®è·µ]
    
    Quality --> Q1[å¤æ‚åº¦æ£€æŸ¥]
    Quality --> Q2[é‡å¤ä»£ç ]
    
    Security --> S1[SQLæ³¨å…¥]
    Security --> S2[XSSæ¼æ´]
    
    Performance --> P1[ç®—æ³•æ•ˆç‡]
    Performance --> P2[èµ„æºä½¿ç”¨]
    
    Style --> St1[å‘½åè§„èŒƒ]
    Style --> St2[æ ¼å¼åŒ–]
    
    Best --> B1[è®¾è®¡æ¨¡å¼]
    Best --> B2[SOLIDåŸåˆ™]
    
    style Code fill:#ff6b6b
    style Quality fill:#51cf66
    style Security fill:#ffd43b
    style Performance fill:#339af0
    style Style fill:#a855f7
    style Best fill:#f1f8e9
```

### 2. å®ç°è¦ç‚¹

```java
public class CodeReviewAgent extends Agent {
    private QualityAnalyzer qualityAnalyzer;
    private SecurityScanner securityScanner;
    private PerformanceAnalyzer perfAnalyzer;
    
    public ReviewReport review(CodeChange change) {
        ReviewReport report = new ReviewReport();
        
        // 1. è´¨é‡æ£€æŸ¥
        report.addIssues(qualityAnalyzer.analyze(change));
        
        // 2. å®‰å…¨æ‰«æ
        report.addIssues(securityScanner.scan(change));
        
        // 3. æ€§èƒ½åˆ†æ
        report.addIssues(perfAnalyzer.analyze(change));
        
        // 4. ç”Ÿæˆæ”¹è¿›å»ºè®®
        report.setSuggestions(generateSuggestions(report.getIssues()));
        
        return report;
    }
}
```

### 3. å®¡æŸ¥æŠ¥å‘Šç¤ºä¾‹

```markdown
## ä»£ç å®¡æŸ¥æŠ¥å‘Š

### âŒ é«˜ä¼˜å…ˆçº§é—®é¢˜ (2)

1. **æ½œåœ¨çš„SQLæ³¨å…¥é£é™©** (Security)
   - ä½ç½®: UserDao.java:45
   - é—®é¢˜: ç›´æ¥æ‹¼æ¥SQLè¯­å¥
   - å»ºè®®: ä½¿ç”¨PreparedStatement

2. **æ€§èƒ½é—®é¢˜ï¼šå¾ªç¯ä¸­çš„æ•°æ®åº“æŸ¥è¯¢** (Performance)
   - ä½ç½®: UserService.java:78
   - é—®é¢˜: N+1æŸ¥è¯¢é—®é¢˜
   - å»ºè®®: ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢æˆ–JOIN

### âš ï¸ ä¸­ä¼˜å…ˆçº§é—®é¢˜ (3)

3. **ä»£ç å¤æ‚åº¦è¿‡é«˜** (Quality)
   - æ–¹æ³•: processOrder()
   - åœˆå¤æ‚åº¦: 15 (å»ºè®®<10)
   - å»ºè®®: æ‹†åˆ†ä¸ºå¤šä¸ªå°æ–¹æ³•

### âœ… ä»£ç ä¼˜ç‚¹

- å‘½åæ¸…æ™°,éµå¾ªé©¼å³°å‘½åè§„èŒƒ
- é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
- è‰¯å¥½çš„å¼‚å¸¸å¤„ç†
```

---

## å››ã€æµ‹è¯•ç”Ÿæˆæ™ºèƒ½ä½“

### 1. æµ‹è¯•ç”Ÿæˆæµç¨‹

```mermaid
graph LR
    Source[æºä»£ç ] --> Analyze[åˆ†æåŠŸèƒ½]
    Analyze --> Cases[ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹]
    Cases --> Code[ç”Ÿæˆæµ‹è¯•ä»£ç ]
    Code --> Coverage[è¦†ç›–ç‡æ£€æŸ¥]
    Coverage --> Optimize[ä¼˜åŒ–ç”¨ä¾‹]
    
    style Source fill:#e1f5ff
    style Code fill:#51cf66
    style Coverage fill:#ffd43b
```

### 2. æ ¸å¿ƒå®ç°

```java
public class TestGenerationAgent extends Agent {
    private LLMService llmService;
    private CoverageAnalyzer coverageAnalyzer;
    
    public TestSuite generateTests(SourceCode source) {
        // 1. åˆ†ææºä»£ç 
        List<TestableUnit> units = identifyTestableUnits(source);
        
        // 2. ä¸ºæ¯ä¸ªå•å…ƒç”Ÿæˆæµ‹è¯•
        List<TestCase> testCases = units.stream()
            .map(this::generateTestCase)
            .collect(Collectors.toList());
        
        // 3. æ£€æŸ¥è¦†ç›–ç‡
        CoverageReport coverage = coverageAnalyzer.analyze(testCases);
        
        // 4. è¡¥å……ç¼ºå¤±çš„æµ‹è¯•
        if (coverage.getLineCoverage() < 0.8) {
            testCases.addAll(generateAdditionalTests(coverage));
        }
        
        return new TestSuite(testCases);
    }
}
```

### 3. ç”Ÿæˆç¤ºä¾‹

**åŸå§‹ä»£ç **ï¼š
```java
public class Calculator {
    public int divide(int a, int b) {
        if (b == 0) {
            throw new IllegalArgumentException("é™¤æ•°ä¸èƒ½ä¸º0");
        }
        return a / b;
    }
}
```

**AIç”Ÿæˆçš„æµ‹è¯•**ï¼š
```java
@Test
public class CalculatorTest {
    private Calculator calculator;
    
    @BeforeEach
    void setUp() {
        calculator = new Calculator();
    }
    
    @Test
    @DisplayName("æ­£å¸¸é™¤æ³•è¿ç®—")
    void testDivideNormal() {
        assertEquals(2, calculator.divide(10, 5));
        assertEquals(-2, calculator.divide(10, -5));
    }
    
    @Test
    @DisplayName("é™¤æ•°ä¸ºé›¶æŠ›å‡ºå¼‚å¸¸")
    void testDivideByZero() {
        assertThrows(IllegalArgumentException.class, 
            () -> calculator.divide(10, 0));
    }
    
    @Test
    @DisplayName("è¾¹ç•Œå€¼æµ‹è¯•")
    void testDivideBoundary() {
        assertEquals(1, calculator.divide(1, 1));
        assertEquals(0, calculator.divide(0, 1));
    }
}
```

**æµ‹è¯•è¦†ç›–**ï¼š
- âœ… æ­£å¸¸è·¯å¾„
- âœ… å¼‚å¸¸è·¯å¾„
- âœ… è¾¹ç•Œå€¼
- âœ… è¦†ç›–ç‡ï¼š100%

---

## äº”ã€æ™ºèƒ½ä½“åä½œæœºåˆ¶

### 1. å…¸å‹å·¥ä½œæµ

ä¸€ä¸ªå®Œæ•´çš„ç¼–ç¨‹è¾…åŠ©åœºæ™¯ï¼š

```mermaid
sequenceDiagram
    participant User as ğŸ‘¨â€ğŸ’» ç”¨æˆ·
    participant Orch as ç¼–æ’å™¨
    participant Und as ç†è§£Agent
    participant Gen as ç”ŸæˆAgent
    participant Rev as å®¡æŸ¥Agent
    participant Test as æµ‹è¯•Agent
    
    User->>Orch: ç¼–å†™ç™»å½•åŠŸèƒ½
    
    Orch->>Und: åˆ†æç°æœ‰ä»£ç 
    Und-->>Orch: ä»£ç ç»“æ„+ä¸Šä¸‹æ–‡
    
    Orch->>Gen: ç”Ÿæˆç™»å½•ä»£ç 
    Gen-->>Orch: åˆç‰ˆä»£ç 
    
    Orch->>Rev: å®¡æŸ¥ä»£ç 
    Rev-->>Orch: å‘ç°2ä¸ªé—®é¢˜
    
    Orch->>Gen: æ ¹æ®å®¡æŸ¥æ„è§ä¼˜åŒ–
    Gen-->>Orch: ä¼˜åŒ–åä»£ç 
    
    Orch->>Test: ç”Ÿæˆå•å…ƒæµ‹è¯•
    Test-->>Orch: æµ‹è¯•ä»£ç 
    
    Orch-->>User: å®Œæ•´çš„åŠŸèƒ½+æµ‹è¯•
```

### 2. ç¼–æ’å™¨å®ç°

```java
public class CodingAssistantOrchestrator {
    private CodeUnderstandingAgent understandingAgent;
    private CodeGenerationAgent generationAgent;
    private CodeReviewAgent reviewAgent;
    private TestGenerationAgent testAgent;
    
    public CodingResult assistCoding(CodingRequest request) {
        CodingResult result = new CodingResult();
        
        // ç¬¬1æ­¥ï¼šç†è§£ä¸Šä¸‹æ–‡
        CodeContext context = understandingAgent.analyze(
            request.getCurrentFile(),
            request.getCursorPosition()
        );
        
        // ç¬¬2æ­¥ï¼šç”Ÿæˆä»£ç ï¼ˆå¯èƒ½å¤šæ¬¡è¿­ä»£ï¼‰
        GeneratedCode code = null;
        ReviewReport review = null;
        int maxIterations = 3;
        
        for (int i = 0; i < maxIterations; i++) {
            // ç”Ÿæˆä»£ç 
            code = generationAgent.generate(request, context);
            
            // å®¡æŸ¥ä»£ç 
            review = reviewAgent.review(code);
            
            // å¦‚æœæ²¡æœ‰ä¸¥é‡é—®é¢˜ï¼Œè·³å‡ºå¾ªç¯
            if (!review.hasCriticalIssues()) {
                break;
            }
            
            // æ ¹æ®å®¡æŸ¥æ„è§ä¼˜åŒ–
            request = request.withReviewFeedback(review);
        }
        
        // ç¬¬3æ­¥ï¼šç”Ÿæˆæµ‹è¯•
        TestSuite tests = testAgent.generateTests(code);
        
        // ç¬¬4æ­¥ï¼šç»„è£…ç»“æœ
        result.setCode(code);
        result.setTests(tests);
        result.setReview(review);
        
        return result;
    }
}
```

---

## å®æˆ˜æ¡ˆä¾‹ï¼šå®ç°RESTful API

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼šç”¨AIåŠ©æ‰‹å®ç°ä¸€ä¸ªç”¨æˆ·ç®¡ç†APIã€‚

### 1. ç”¨æˆ·éœ€æ±‚

```java
// ç”¨æˆ·è¾“å…¥
/**
 * å®ç°ç”¨æˆ·ç®¡ç†çš„RESTful API
 * éœ€æ±‚ï¼š
 * 1. åˆ›å»ºç”¨æˆ·ï¼ˆPOST /usersï¼‰
 * 2. æŸ¥è¯¢ç”¨æˆ·ï¼ˆGET /users/{id}ï¼‰  
 * 3. æ›´æ–°ç”¨æˆ·ï¼ˆPUT /users/{id}ï¼‰
 * 4. åˆ é™¤ç”¨æˆ·ï¼ˆDELETE /users/{id}ï¼‰
 * 
 * è¦æ±‚ï¼š
 * - ä½¿ç”¨Spring Boot
 * - å‚æ•°æ ¡éªŒ
 * - å¼‚å¸¸å¤„ç†
 * - åŒ…å«å•å…ƒæµ‹è¯•
 */
```

### 2. AIç”Ÿæˆçš„ä»£ç ç»“æ„

```mermaid
graph TB
    Controller[UserController<br/>RESTæ¥å£]
    Service[UserService<br/>ä¸šåŠ¡é€»è¾‘]
    Repository[UserRepository<br/>æ•°æ®è®¿é—®]
    Entity[User<br/>å®ä½“ç±»]
    DTO[UserDTO<br/>æ•°æ®ä¼ è¾“]
    Test[UserControllerTest<br/>å•å…ƒæµ‹è¯•]
    
    Controller --> Service
    Service --> Repository
    Repository --> Entity
    Controller --> DTO
    DTO -.è½¬æ¢.-> Entity
    Test -.æµ‹è¯•.-> Controller
    
    style Controller fill:#339af0
    style Service fill:#51cf66
    style Repository fill:#ffd43b
    style Test fill:#ff6b6b
```

### 3. ç”Ÿæˆçš„ä»£ç ç‰‡æ®µ

```java
@RestController
@RequestMapping("/api/users")
@Validated
public class UserController {
    private final UserService userService;
    
    @PostMapping
    public ResponseEntity<UserDTO> createUser(
            @Valid @RequestBody UserCreateRequest request) {
        User user = userService.createUser(request);
        return ResponseEntity.status(HttpStatus.CREATED)
                           .body(UserDTO.from(user));
    }
    
    @GetMapping("/{id}")
    public ResponseEntity<UserDTO> getUser(@PathVariable Long id) {
        return userService.findById(id)
                         .map(UserDTO::from)
                         .map(ResponseEntity::ok)
                         .orElse(ResponseEntity.notFound().build());
    }
    
    // ... å…¶ä»–æ–¹æ³•
}
```

### 4. è‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•

```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - æˆåŠŸåœºæ™¯")
    void createUser_Success() throws Exception {
        // Given
        UserCreateRequest request = new UserCreateRequest("test@example.com", "Test User");
        User mockUser = new User(1L, "test@example.com", "Test User");
        when(userService.createUser(any())).thenReturn(mockUser);
        
        // When & Then
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isCreated())
            .andExpect(jsonPath("$.id").value(1))
            .andExpect(jsonPath("$.email").value("test@example.com"));
    }
    
    // ... æ›´å¤šæµ‹è¯•ç”¨ä¾‹
}
```

---

## æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ

### 1. å“åº”é€Ÿåº¦ä¼˜åŒ–

```mermaid
graph LR
    A[ç”¨æˆ·è¾“å…¥] --> B{æ˜¯å¦éœ€è¦LLM?}
    B -->|å¦| C[æœ¬åœ°å¤„ç†<br/>< 100ms]
    B -->|æ˜¯| D[LLMè°ƒç”¨<br/>1-3s]
    
    D --> E[æµå¼è¿”å›]
    D --> F[ç¼“å­˜ç»“æœ]
    
    style C fill:#51cf66
    style D fill:#ffd43b
    style E fill:#339af0
    style F fill:#a855f7
```

**ä¼˜åŒ–ç­–ç•¥**ï¼š
- **æœ¬åœ°ä¼˜å…ˆ**ï¼šç®€å•ä»»åŠ¡ï¼ˆå¦‚æ ¼å¼åŒ–ï¼‰ä¸è°ƒç”¨LLM
- **æµå¼è¿”å›**ï¼šç”Ÿæˆä»£ç æ—¶é€è¡Œæ˜¾ç¤º,æå‡ä½“éªŒ
- **æ™ºèƒ½ç¼“å­˜**ï¼šç›¸ä¼¼è¯·æ±‚å¤ç”¨ç»“æœ

### 2. ä¸Šä¸‹æ–‡ç®¡ç†

```java
public class ContextManager {
    private static final int MAX_CONTEXT_LINES = 100;
    
    public CodeContext buildContext(String fileId, int cursorLine) {
        // 1. å½“å‰æ–‡ä»¶ä¸Šä¸‹æ–‡ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
        List<String> currentFile = getRelevantLines(fileId, cursorLine, 50);
        
        // 2. ç›¸å…³æ–‡ä»¶ï¼ˆimportçš„ç±»ï¼‰
        List<String> relatedFiles = getRelatedFiles(fileId, 30);
        
        // 3. é¡¹ç›®å…¨å±€ä¿¡æ¯ï¼ˆä¾èµ–ã€é…ç½®ï¼‰
        ProjectInfo projectInfo = getProjectInfo(20);
        
        // 4. ç»„è£…å¹¶é™åˆ¶æ€»é•¿åº¦
        return buildContext(currentFile, relatedFiles, projectInfo);
    }
}
```

### 3. é”™è¯¯å¤„ç†

```java
public class RobustGenerationAgent extends CodeGenerationAgent {
    @Override
    public GeneratedCode generate(GenerationRequest request) {
        try {
            return super.generate(request);
        } catch (LLMTimeoutException e) {
            // é™çº§ç­–ç•¥ï¼šä½¿ç”¨æ¨¡æ¿
            return generateFromTemplate(request);
        } catch (InvalidCodeException e) {
            // é‡è¯•ç­–ç•¥ï¼šç®€åŒ–æç¤ºè¯
            return generateWithSimplifiedPrompt(request);
        }
    }
}
```

---

## æœ¬èŠ‚å°ç»“

### å…³é”®è¦ç‚¹

1. **åˆ†å±‚è®¾è®¡**ï¼šç†è§£â†’ç”Ÿæˆâ†’å®¡æŸ¥â†’æµ‹è¯•,å„å¸å…¶èŒ
2. **æ™ºèƒ½ç¼–æ’**ï¼šé€šè¿‡ç¼–æ’å™¨åè°ƒå¤šä¸ªæ™ºèƒ½ä½“
3. **ä¸Šä¸‹æ–‡ä¸ºç‹**ï¼šå‡†ç¡®çš„ä¸Šä¸‹æ–‡æ˜¯ç”Ÿæˆè´¨é‡çš„å…³é”®
4. **è¿­ä»£ä¼˜åŒ–**ï¼šç”Ÿæˆåå®¡æŸ¥,æœ‰é—®é¢˜å†ä¼˜åŒ–
5. **äººæœºåä½œ**ï¼šAIè¾…åŠ©è€Œéæ›¿ä»£,æœ€ç»ˆå†³ç­–æƒåœ¨äºº

### å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£AIç¼–ç¨‹åŠ©æ‰‹çš„æ•´ä½“æ¶æ„
- [ ] èƒ½å®ç°ä»£ç ç†è§£æ™ºèƒ½ä½“
- [ ] èƒ½å®ç°ä»£ç ç”Ÿæˆæ™ºèƒ½ä½“  
- [ ] èƒ½å®ç°ä»£ç å®¡æŸ¥æ™ºèƒ½ä½“
- [ ] èƒ½å®ç°æµ‹è¯•ç”Ÿæˆæ™ºèƒ½ä½“
- [ ] ç†è§£æ™ºèƒ½ä½“åä½œæœºåˆ¶

### è¿›é˜¶æ–¹å‘

- ğŸš€ **æ”¯æŒæ›´å¤šè¯­è¨€**ï¼šPythonã€JavaScriptã€Goç­‰
- ğŸš€ **ä»£ç é‡æ„**ï¼šè‡ªåŠ¨è¯†åˆ«å’Œåº”ç”¨é‡æ„æ¨¡å¼
- ğŸš€ **æ™ºèƒ½é—®ç­”**ï¼šå›ç­”ä»£ç ç›¸å…³é—®é¢˜
- ğŸš€ **Bugä¿®å¤**ï¼šè‡ªåŠ¨å®šä½å’Œä¿®å¤bug

### å®è·µå»ºè®®

```mermaid
graph LR
    A[ä»ç®€å•å¼€å§‹] --> B[ä»£ç è¡¥å…¨]
    B --> C[æ–¹æ³•ç”Ÿæˆ]
    C --> D[æµ‹è¯•ç”Ÿæˆ]
    D --> E[å®Œæ•´åŠŸèƒ½]
    
    style A fill:#e1f5ff
    style E fill:#51cf66
```

---

**ä¸‹ä¸€èŠ‚é¢„å‘Š**ï¼š18.3 æ‰‹ç¨¿æ™ºèƒ½ä½“ - æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæ–‡æ¡£ç†è§£ä¸ç”Ÿæˆç³»ç»Ÿ,è®©AIæˆä¸ºä½ çš„å†™ä½œåŠ©æ‰‹ã€‚

**å‚è€ƒèµ„æº**ï¼š
- TinyAIæºç ï¼š`tinyai-agent-cursor`æ¨¡å—
- Cursorå®˜æ–¹æ–‡æ¡£
- GitHub CopilotæŠ€æœ¯åšå®¢
