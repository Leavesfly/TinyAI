# TinyAI-DL-Func å‡½æ•°è®¡ç®—æ¨¡å—

## ğŸ“– æ¨¡å—ç®€ä»‹

TinyAI-DL-Func æ˜¯ TinyAI æ·±åº¦å­¦ä¹ æ¡†æ¶çš„æ ¸å¿ƒå‡½æ•°è®¡ç®—æ¨¡å—ï¼Œæä¾›äº†å®Œæ•´çš„è‡ªåŠ¨å¾®åˆ†å¼•æ“å®ç°ã€‚è¯¥æ¨¡å—æ˜¯æ·±åº¦å­¦ä¹ æ¡†æ¶çš„æ•°å­¦è¿ç®—åŸºç¡€ï¼Œæ”¯æŒåŠ¨æ€è®¡ç®—å›¾æ„å»ºã€è‡ªåŠ¨æ¢¯åº¦è®¡ç®—å’Œä¸°å¯Œçš„æ•°å­¦å‡½æ•°æ“ä½œã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ”§ **å®Œæ•´çš„è‡ªåŠ¨å¾®åˆ†å¼•æ“**ï¼šæ”¯æŒåŠ¨æ€è®¡ç®—å›¾æ„å»ºå’Œè‡ªåŠ¨æ¢¯åº¦è®¡ç®—
- âš¡ **ä¸°å¯Œçš„æ•°å­¦å‡½æ•°åº“**ï¼šåŒ…å«åŸºç¡€å››åˆ™è¿ç®—ã€æ¿€æ´»å‡½æ•°ã€æŸå¤±å‡½æ•°ç­‰
- ğŸ§® **å¼ºå¤§çš„çŸ©é˜µè¿ç®—**ï¼šæ”¯æŒçŸ©é˜µä¹˜æ³•ã€è½¬ç½®ã€é‡å¡‘ã€å¹¿æ’­ç­‰æ“ä½œ
- ğŸš€ **é«˜æ•ˆçš„æ¢¯åº¦ä¼ æ’­**ï¼šåŒæ—¶æ”¯æŒé€’å½’å’Œè¿­ä»£ä¸¤ç§åå‘ä¼ æ’­å®ç°
- ğŸ“Š **å®Œæ•´çš„æµ‹è¯•è¦†ç›–**ï¼š100% å•å…ƒæµ‹è¯•é€šè¿‡ç‡ï¼Œç¡®ä¿ä»£ç å¯é æ€§

## ğŸ—ï¸ æ¨¡å—æ¶æ„

```
tinyai-dl-func/
â”œâ”€â”€ src/main/java/io/leavesfly/tinyai/
â”‚   â”œâ”€â”€ func/
â”‚   â”‚   â”œâ”€â”€ Variable.java          # è‡ªåŠ¨å¾®åˆ†å˜é‡æ ¸å¿ƒç±»
â”‚   â”‚   â”œâ”€â”€ Function.java          # å‡½æ•°æ“ä½œæŠ½è±¡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ Util.java             # å·¥å…·å‡½æ•°é›†åˆ
â”‚   â”‚   â”œâ”€â”€ base/                 # åŸºç¡€å››åˆ™è¿ç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ Add.java          # åŠ æ³•è¿ç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ Sub.java          # å‡æ³•è¿ç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ Mul.java          # ä¹˜æ³•è¿ç®—ï¼ˆæ”¯æŒå¹¿æ’­ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Div.java          # é™¤æ³•è¿ç®—
â”‚   â”‚   â”‚   â””â”€â”€ Neg.java          # å–è´Ÿè¿ç®—
â”‚   â”‚   â”œâ”€â”€ math/                 # æ•°å­¦å‡½æ•°åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ ReLu.java         # ReLU æ¿€æ´»å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Sigmoid.java      # Sigmoid æ¿€æ´»å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Tanh.java         # Tanh æ¿€æ´»å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ GELU.java         # GELU æ¿€æ´»å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Exp.java          # æŒ‡æ•°å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Log.java          # å¯¹æ•°å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Sin.java          # æ­£å¼¦å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Cos.java          # ä½™å¼¦å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Pow.java          # å¹‚å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Squ.java          # å¹³æ–¹å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Clip.java         # è£å‰ªå‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ Max.java          # æœ€å¤§å€¼å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ Min.java          # æœ€å°å€¼å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ matrix/               # çŸ©é˜µè¿ç®—åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ MatMul.java       # çŸ©é˜µä¹˜æ³•
â”‚   â”‚   â”‚   â”œâ”€â”€ Linear.java       # çº¿æ€§å˜æ¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Transpose.java    # çŸ©é˜µè½¬ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ Reshape.java      # å½¢çŠ¶é‡å¡‘
â”‚   â”‚   â”‚   â”œâ”€â”€ Sum.java          # æ±‚å’Œè¿ç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ SumTo.java        # æŒ‡å®šç»´åº¦æ±‚å’Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ SoftMax.java      # Softmax å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ BroadcastTo.java  # å¹¿æ’­æ“ä½œ
â”‚   â”‚   â”‚   â””â”€â”€ GetItem.java      # ç´¢å¼•å–å€¼
â”‚   â”‚   â””â”€â”€ loss/                 # æŸå¤±å‡½æ•°åº“
â”‚   â”‚       â”œâ”€â”€ MeanSE.java       # å‡æ–¹è¯¯å·®æŸå¤±
â”‚   â”‚       â”œâ”€â”€ SoftmaxCE.java    # Softmax äº¤å‰ç†µæŸå¤±
â”‚   â”‚       â””â”€â”€ SigmoidCE.java    # Sigmoid äº¤å‰ç†µæŸå¤±
â”‚   â””â”€â”€ util/
â”‚       â””â”€â”€ Config.java           # é…ç½®ç®¡ç†ç±»
â””â”€â”€ doc/
    â””â”€â”€ æµ‹è¯•ä¿®å¤æŠ¥å‘Š.md            # å®Œæ•´çš„æµ‹è¯•ä¿®å¤æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

```java
import io.leavesfly.tinyai.func.Variable;
import io.leavesfly.tinyai.ndarr.NdArray;

// åˆ›å»ºå˜é‡
Variable x = new Variable(NdArray.of(new float[][]{{1, 2}, {3, 4}}), "x");
Variable y = new Variable(NdArray.of(new float[][]{{2, 3}, {4, 5}}), "y");

// åŸºç¡€è¿ç®—
Variable z = x.add(y);          // çŸ©é˜µåŠ æ³•
Variable w = x.mul(y);          // çŸ©é˜µä¹˜æ³•ï¼ˆæ”¯æŒå¹¿æ’­ï¼‰
Variable u = z.sigmoid();       // æ¿€æ´»å‡½æ•°

// è‡ªåŠ¨å¾®åˆ†
u.backward();                   // åå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦
System.out.println("xçš„æ¢¯åº¦: " + x.getGrad());
```

### çº¿æ€§å˜æ¢ç¤ºä¾‹

```java
// åˆ›å»ºæƒé‡å’Œåç½®
Variable W = new Variable(NdArray.randn(new int[]{4, 3}), "weight");
Variable b = new Variable(NdArray.zeros(new int[]{4}), "bias");
Variable x = new Variable(NdArray.randn(new int[]{2, 3}), "input");

// çº¿æ€§å˜æ¢: y = xW^T + b
Variable y = x.linear(W, b);

// åº”ç”¨æ¿€æ´»å‡½æ•°
Variable output = y.relu();

// è®¡ç®—æŸå¤±å¹¶åå‘ä¼ æ’­
Variable target = new Variable(NdArray.ones(output.getValue().getShape()));
Variable loss = output.meanSE(target);
loss.backward();
```

## ğŸ§® æ ¸å¿ƒç»„ä»¶è¯¦è§£

### Variable ç±» - è‡ªåŠ¨å¾®åˆ†å˜é‡

`Variable` æ˜¯è‡ªåŠ¨å¾®åˆ†å¼•æ“çš„æ ¸å¿ƒç±»ï¼Œå®ƒä¸ä»…åŒ…å«å˜é‡çš„å€¼ï¼Œè¿˜ç»´æŠ¤æ¢¯åº¦ä¿¡æ¯å’Œè®¡ç®—å›¾ç»“æ„ã€‚

#### ä¸»è¦ç‰¹æ€§
- **å€¼å­˜å‚¨**ï¼šä½¿ç”¨ `NdArray` å­˜å‚¨å¤šç»´æ•°ç»„æ•°æ®
- **æ¢¯åº¦ç®¡ç†**ï¼šè‡ªåŠ¨ç»´æŠ¤å’Œç´¯ç§¯æ¢¯åº¦ä¿¡æ¯
- **è®¡ç®—å›¾æ„å»º**ï¼šé€šè¿‡ `creator` å­—æ®µç»´æŠ¤è®¡ç®—å›¾ç»“æ„
- **æ“ä½œç¬¦é‡è½½**ï¼šæ”¯æŒç›´è§‚çš„æ•°å­¦è¿ç®—è¯­æ³•

#### å…³é”®æ–¹æ³•
```java
// åå‘ä¼ æ’­ï¼ˆé€’å½’å®ç°ï¼‰
public void backward()

// åå‘ä¼ æ’­ï¼ˆè¿­ä»£å®ç°ï¼Œé¿å…æ ˆæº¢å‡ºï¼‰
public void backwardIterative()

// ä¸°å¯Œçš„æ•°å­¦è¿ç®—æ–¹æ³•
public Variable add(Variable other)
public Variable mul(Variable other)
public Variable sigmoid()
public Variable relu()
public Variable matMul(Variable other)
// ... æ›´å¤šè¿ç®—æ–¹æ³•
```

### Function ç±» - å‡½æ•°æ“ä½œåŸºç±»

`Function` æ˜¯æ‰€æœ‰æ•°å­¦å‡½æ•°æ“ä½œçš„æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰äº†å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­çš„æ ‡å‡†æ¥å£ã€‚

#### è®¾è®¡æ¨¡å¼
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ï¼šå®šä¹‰äº† `call` æ–¹æ³•çš„æ‰§è¡Œæµç¨‹
- **ç­–ç•¥æ¨¡å¼**ï¼šå­ç±»å®ç°å…·ä½“çš„ `forward` å’Œ `backward` é€»è¾‘

#### æ ¸å¿ƒæ¥å£
```java
// å‰å‘ä¼ æ’­è®¡ç®—
public abstract NdArray forward(NdArray... inputs);

// åå‘ä¼ æ’­è®¡ç®—ï¼ˆæ±‚å¯¼ï¼‰
public abstract List<NdArray> backward(NdArray yGrad);

// è¾“å…¥å‚æ•°æ•°é‡è¦æ±‚
public abstract int requireInputNum();
```

## ğŸ”¬ æ•°å­¦å‡½æ•°åº“

### åŸºç¡€è¿ç®— (base åŒ…)
- **Add/Sub/Mul/Div**ï¼šå››åˆ™è¿ç®—ï¼Œæ”¯æŒå¹¿æ’­æœºåˆ¶
- **Neg**ï¼šå–è´Ÿè¿ç®—

### æ•°å­¦å‡½æ•° (math åŒ…)
- **æ¿€æ´»å‡½æ•°**ï¼šReLU, Sigmoid, Tanh, GELU
- **åŸºç¡€å‡½æ•°**ï¼šExp, Log, Sin, Cos, Pow, Squ
- **å®ç”¨å‡½æ•°**ï¼šClip, Max, Min

### çŸ©é˜µè¿ç®— (matrix åŒ…)
- **æ ¸å¿ƒè¿ç®—**ï¼šMatMul, Linear, Transpose
- **å½¢çŠ¶æ“ä½œ**ï¼šReshape, BroadcastTo
- **èšåˆæ“ä½œ**ï¼šSum, SumTo, SoftMax
- **ç´¢å¼•æ“ä½œ**ï¼šGetItem

### æŸå¤±å‡½æ•° (loss åŒ…)
- **MeanSE**ï¼šå‡æ–¹è¯¯å·®æŸå¤±
- **SoftmaxCE**ï¼šSoftmax äº¤å‰ç†µæŸå¤±
- **SigmoidCE**ï¼šSigmoid äº¤å‰ç†µæŸå¤±

## ğŸ§ª æµ‹è¯•ä¸è´¨é‡ä¿è¯

æœ¬æ¨¡å—æ‹¥æœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–ï¼Œ**æµ‹è¯•é€šè¿‡ç‡è¾¾åˆ° 100%**ã€‚

### æµ‹è¯•ç»Ÿè®¡
- **æ€»æµ‹è¯•æ•°**ï¼š76
- **é€šè¿‡æµ‹è¯•**ï¼š76 (100%)
- **å¤±è´¥æµ‹è¯•**ï¼š0
- **é”™è¯¯æµ‹è¯•**ï¼š0

### æµ‹è¯•è¦†ç›–èŒƒå›´
- âœ… æ‰€æœ‰æ•°å­¦å‡½æ•°çš„æ­£ç¡®æ€§éªŒè¯
- âœ… æ¢¯åº¦è®¡ç®—çš„å‡†ç¡®æ€§æµ‹è¯•
- âœ… è¾¹ç•Œå€¼å’Œç‰¹æ®Šæƒ…å†µå¤„ç†
- âœ… å¹¿æ’­æœºåˆ¶çš„å®Œæ•´æ€§éªŒè¯
- âœ… çŸ©é˜µè¿ç®—çš„æ•°å€¼ç²¾åº¦æµ‹è¯•

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=VariableTest
mvn test -Dtest=MathFunctionsTest
```

## ğŸ”§ é…ç½®ä¸ä¾èµ–

### Maven ä¾èµ–
```xml
<dependency>
    <groupId>io.leavesfly.tinyai</groupId>
    <artifactId>tinyai-dl-func</artifactId>
    <version>1.0-SNAPSHOT</version>
</dependency>
```

### æ¨¡å—ä¾èµ–
- **tinyai-dl-ndarr**ï¼šå¤šç»´æ•°ç»„åŸºç¡€åº“
- **jfreechart**ï¼šå›¾è¡¨ç»˜åˆ¶æ”¯æŒ
- **junit**ï¼šå•å…ƒæµ‹è¯•æ¡†æ¶

### é…ç½®é€‰é¡¹
é€šè¿‡ `Config` ç±»å¯ä»¥æ§åˆ¶æ¨¡å—è¡Œä¸ºï¼š
```java
// è®­ç»ƒæ¨¡å¼å¼€å…³ï¼ˆå½±å“è®¡ç®—å›¾æ„å»ºï¼‰
Config.train = true;  // å¼€å¯è®¡ç®—å›¾æ„å»º
Config.train = false; // ä»…æ‰§è¡Œå‰å‘è®¡ç®—ï¼ŒèŠ‚çœå†…å­˜
```

## ğŸ“ˆ æ€§èƒ½ç‰¹æ€§

### è‡ªåŠ¨å¾®åˆ†ä¼˜åŒ–
- **åŠ¨æ€è®¡ç®—å›¾**ï¼šåªåœ¨è®­ç»ƒæ¨¡å¼ä¸‹æ„å»ºè®¡ç®—å›¾ï¼Œæ¨ç†æ—¶èŠ‚çœå†…å­˜
- **åŒé‡åå‘ä¼ æ’­**ï¼šæä¾›é€’å½’å’Œè¿­ä»£ä¸¤ç§å®ç°ï¼Œé€‚åº”ä¸åŒåœºæ™¯
- **æ¢¯åº¦ç´¯ç§¯**ï¼šæ”¯æŒæ¢¯åº¦çš„è‡ªåŠ¨ç´¯ç§¯å’Œå¤ç”¨

### å†…å­˜ç®¡ç†
- **å»¶è¿Ÿè®¡ç®—**ï¼šåªåœ¨éœ€è¦æ—¶æ„å»ºè®¡ç®—å›¾ç»“æ„
- **èµ„æºæ¸…ç†**ï¼šæä¾› `unChain()` æ–¹æ³•æ–­å¼€è®¡ç®—å›¾è¿æ¥
- **åºåˆ—åŒ–æ”¯æŒ**ï¼šæ ¸å¿ƒç±»å®ç° `Serializable` æ¥å£

## ğŸ› ï¸ å¼€å‘ä¸æ‰©å±•

### æ·»åŠ æ–°çš„æ•°å­¦å‡½æ•°
1. ç»§æ‰¿ `Function` æŠ½è±¡ç±»
2. å®ç° `forward` æ–¹æ³•ï¼ˆå‰å‘è®¡ç®—ï¼‰
3. å®ç° `backward` æ–¹æ³•ï¼ˆæ¢¯åº¦è®¡ç®—ï¼‰
4. æŒ‡å®š `requireInputNum` è¿”å›å€¼
5. åœ¨ `Variable` ç±»ä¸­æ·»åŠ å¯¹åº”çš„ä¾¿æ·æ–¹æ³•

ç¤ºä¾‹ï¼š
```java
public class MyFunction extends Function {
    @Override
    public NdArray forward(NdArray... inputs) {
        // å®ç°å‰å‘è®¡ç®—é€»è¾‘
        return result;
    }
    
    @Override
    public List<NdArray> backward(NdArray yGrad) {
        // å®ç°æ¢¯åº¦è®¡ç®—é€»è¾‘
        return Arrays.asList(inputGrads);
    }
    
    @Override
    public int requireInputNum() {
        return 1; // æˆ–å…·ä½“çš„è¾“å…¥å‚æ•°æ•°é‡
    }
}
```

### è°ƒè¯•æŠ€å·§
- ä½¿ç”¨ `Variable.setName()` ä¸ºå˜é‡å‘½åï¼Œä¾¿äºè°ƒè¯•
- åˆ©ç”¨ `Config.train` å¼€å…³æ§åˆ¶è®¡ç®—å›¾æ„å»º
- æŸ¥çœ‹ `doc/æµ‹è¯•ä¿®å¤æŠ¥å‘Š.md` äº†è§£å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. ç¡®ä¿æ‰€æœ‰æ–°åŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•
2. éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ
3. ä¸ºå…¬å…±æ–¹æ³•æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
4. è¿è¡Œ `mvn test` ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
5. æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œç¤ºä¾‹

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0-SNAPSHOT
- âœ… å®Œæ•´çš„è‡ªåŠ¨å¾®åˆ†å¼•æ“å®ç°
- âœ… ä¸°å¯Œçš„æ•°å­¦å‡½æ•°åº“
- âœ… 100% å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… å¹¿æ’­æœºåˆ¶æ”¯æŒ
- âœ… åŒé‡åå‘ä¼ æ’­å®ç°
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œç¤ºä¾‹

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨å¼€æºè®¸å¯è¯ï¼Œè¯¦æƒ…è¯·å‚é˜…é¡¹ç›®æ ¹ç›®å½•çš„ LICENSE æ–‡ä»¶ã€‚

---

**TinyAI-DL-Func** - ä¸ºæ·±åº¦å­¦ä¹ æä¾›åšå®çš„æ•°å­¦åŸºç¡€ ğŸš€