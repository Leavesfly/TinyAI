# åº”ç”¨ç¤ºä¾‹

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [SimpleConvNetExample.java](file://tinyai-deeplearning-case/src/main/java/io/leavesfly/tinyai/example/cv/SimpleConvNetExample.java) - *æ›´æ–°äº†ç¤ºä¾‹ä»£ç *
- [SimpleConvNet.java](file://tinyai-deeplearning-nnet/src/main/java/io/leavesfly/tinyai/nnet/block/SimpleConvNet.java) - *ç½‘ç»œæ¶æ„å®ç°*
- [GPT2Demo.java](file://tinyai-model-gpt/src/main/java/io/leavesfly/tinyai/gpt2/GPT2Demo.java) - *GPT-2æ¨¡å‹æ¼”ç¤º*
- [GPT3Demo.java](file://tinyai-model-gpt/src/main/java/io/leavesfly/tinyai/gpt3/GPT3Demo.java) - *æ–°å¢GPT-3æ¨¡å‹æ¼”ç¤º*
- [Qwen3Demo.java](file://tinyai-model-qwen/src/main/java/io/leavesfly/tinyai/qwen3/Qwen3Demo.java) - *æ–°å¢Qwen3æ¨¡å‹æ¼”ç¤º*
- [CartPoleDQNExample.java](file://tinyai-deeplearning-case/src/main/java/io/leavesfly/tinyai/example/rl/CartPoleDQNExample.java) - *å¼ºåŒ–å­¦ä¹ ç¤ºä¾‹*
</cite>

## æ›´æ–°æ‘˜è¦
**å˜æ›´å†…å®¹**
- æ ¹æ®ä»£ç å˜æ›´æ›´æ–°äº†è®¡ç®—æœºè§†è§‰ç¤ºä¾‹éƒ¨åˆ†
- æ–°å¢äº†GPT-3æ¨¡å‹åº”ç”¨ç¤ºä¾‹
- æ–°å¢äº†Qwen3æ¨¡å‹åº”ç”¨ç¤ºä¾‹
- æ›´æ–°äº†è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹ä»¥åæ˜ æœ€æ–°å®ç°
- ä¿æŒå¼ºåŒ–å­¦ä¹ ç¤ºä¾‹ä¸å˜

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [è®¡ç®—æœºè§†è§‰ç¤ºä¾‹ - SimpleConvNet](#è®¡ç®—æœºè§†è§‰ç¤ºä¾‹---simpleconvnet)
3. [è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹ - GPT2](#è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹---gpt2)
4. [è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹ - GPT3](#è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹---gpt3)
5. [è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹ - Qwen3](#è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹---qwen3)
6. [å¼ºåŒ–å­¦ä¹ ç¤ºä¾‹ - CartPoleDQN](#å¼ºåŒ–å­¦ä¹ ç¤ºä¾‹---cartpoledqn)
7. [æœ€ä½³å®è·µæŒ‡å—](#æœ€ä½³å®è·µæŒ‡å—)
8. [å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ)
9. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

TinyAIæ¡†æ¶æä¾›äº†ä¸°å¯Œçš„åº”ç”¨ç¤ºä¾‹ï¼Œæ¶µç›–äº†è®¡ç®—æœºè§†è§‰ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œå¼ºåŒ–å­¦ä¹ ä¸‰å¤§é¢†åŸŸã€‚è¿™äº›ç¤ºä¾‹ä¸ä»…å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨TinyAIè¿›è¡Œå®é™…å¼€å‘ï¼Œè¿˜åŒ…å«äº†å®Œæ•´çš„æ•°æ®å‡†å¤‡ã€æ¨¡å‹è®­ç»ƒå’Œç»“æœè¯„ä¼°æµç¨‹ã€‚é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€ŸæŒæ¡TinyAIçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶å°†å…¶åº”ç”¨äºè‡ªå·±çš„é¡¹ç›®ä¸­ã€‚

## è®¡ç®—æœºè§†è§‰ç¤ºä¾‹ - SimpleConvNet

SimpleConvNetæ˜¯ä¸€ä¸ªå¢å¼ºçš„æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œå®ç°ï¼Œä¸“é—¨è®¾è®¡ç”¨äºå›¾åƒåˆ†ç±»ä»»åŠ¡ã€‚å®ƒæ”¯æŒå¤šç§è¾“å…¥æ ¼å¼ï¼ŒåŒ…æ‹¬MNISTæ‰‹å†™æ•°å­—è¯†åˆ«å’ŒCIFAR-10å›¾åƒåˆ†ç±»ã€‚

### å·ç§¯ç¥ç»ç½‘ç»œæ¶æ„

SimpleConvNeté‡‡ç”¨ç»å…¸çš„å·ç§¯ç¥ç»ç½‘ç»œæ¶æ„ï¼ŒåŒ…å«ä»¥ä¸‹å…³é”®ç»„ä»¶ï¼š

```mermaid
graph TB
subgraph "SimpleConvNetæ¶æ„"
Input["è¾“å…¥å›¾åƒ<br/>28x28x1 æˆ– 32x32x3"]
subgraph "å·ç§¯å—1"
Conv1["å·ç§¯å±‚<br/>3x3 kernel"]
BN1["æ‰¹é‡å½’ä¸€åŒ–"]
ReLU1["ReLUæ¿€æ´»"]
Pool1["æœ€å¤§æ± åŒ–<br/>2x2"]
end
subgraph "å·ç§¯å—2"
Conv2["å·ç§¯å±‚<br/>3x3 kernel"]
BN2["æ‰¹é‡å½’ä¸€åŒ–"]
ReLU2["ReLUæ¿€æ´»"]
Pool2["æœ€å¤§æ± åŒ–<br/>2x2"]
end
subgraph "å·ç§¯å—3"
Conv3["å·ç§¯å±‚<br/>3x3 kernel"]
BN3["æ‰¹é‡å½’ä¸€åŒ–"]
ReLU3["ReLUæ¿€æ´»"]
Pool3["æœ€å¤§æ± åŒ–<br/>2x2"]
end
Flatten["å±•å¹³å±‚"]
FC1["å…¨è¿æ¥å±‚<br/>éšè—èŠ‚ç‚¹128"]
BN4["æ‰¹é‡å½’ä¸€åŒ–"]
ReLU4["ReLUæ¿€æ´»"]
Dropout1["Dropout<br/>0.3-0.5"]
FC2["å…¨è¿æ¥å±‚<br/>éšè—èŠ‚ç‚¹64"]
BN5["æ‰¹é‡å½’ä¸€åŒ–"]
ReLU5["ReLUæ¿€æ´»"]
Dropout2["Dropout<br/>0.3-0.5"]
Output["è¾“å‡ºå±‚<br/>ç±»åˆ«æ•°"]
end
Input --> Conv1
Conv1 --> BN1
BN1 --> ReLU1
ReLU1 --> Pool1
Pool1 --> Conv2
Conv2 --> BN2
BN2 --> ReLU2
ReLU2 --> Pool2
Pool2 --> Conv3
Conv3 --> BN3
BN3 --> ReLU3
ReLU3 --> Pool3
Pool3 --> Flatten
Flatten --> FC1
FC1 --> BN4
BN4 --> ReLU4
ReLU4 --> Dropout1
Dropout1 --> FC2
FC2 --> BN5
BN5 --> ReLU5
ReLU5 --> Dropout2
Dropout2 --> Output
```

**å›¾è¡¨æ¥æº**
- [SimpleConvNet.java](file://tinyai-deeplearning-nnet/src/main/java/io/leavesfly/tinyai/nnet/block/SimpleConvNet.java#L30-L348)

### MNISTæ‰‹å†™æ•°å­—è¯†åˆ«æµç¨‹

MNISTæ‰‹å†™æ•°å­—è¯†åˆ«æ˜¯æœ€ç»å…¸çš„è®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¹‹ä¸€ã€‚SimpleConvNetExampleå±•ç¤ºäº†å®Œæ•´çš„MNISTè¯†åˆ«æµç¨‹ï¼š

#### æ•°æ®å‡†å¤‡é˜¶æ®µ

```java
// åˆ›å»ºæ¨¡æ‹Ÿè¾“å…¥æ•°æ® (batch_size=2, channels=1, height=28, width=28)
Shape inputShape = Shape.of(2, 1, 28, 28);
NdArray inputData = NdArray.likeRandomN(inputShape);
Variable input = new Variable(inputData);
```

#### æ¨¡å‹æ„å»ºé˜¶æ®µ

```java
// æ„å»ºMNISTç½‘ç»œ
SimpleConvNet convNet = SimpleConvNet.buildMnistConvNet();
System.out.println("âœ“ MNISTç½‘ç»œæ„å»ºæˆåŠŸ");
```

#### å‰å‘ä¼ æ’­é˜¶æ®µ

```java
// å‰å‘ä¼ æ’­
Variable output = convNet.layerForward(input);
System.out.println("è¾“å‡ºå½¢çŠ¶: " + output.getValue().getShape().toString());
```

#### æ€§èƒ½éªŒè¯

```java
// éªŒè¯è¾“å‡ºå½¢çŠ¶
Shape expectedOutput = Shape.of(2, 10);  // batch_size=2, num_classes=10
if (output.getValue().getShape().toString().equals(expectedOutput.toString())) {
    System.out.println("âœ“ è¾“å‡ºå½¢çŠ¶éªŒè¯é€šè¿‡");
}
```

### CIFAR-10å›¾åƒåˆ†ç±»

CIFAR-10æ•°æ®é›†åŒ…å«10ç±»å½©è‰²å›¾åƒï¼Œæ¯ç±»1000å¼ è®­ç»ƒå›¾åƒå’Œ1000å¼ æµ‹è¯•å›¾åƒã€‚SimpleConvNetæ”¯æŒCIFAR-10çš„å®Œæ•´é…ç½®ï¼š

```java
// æ„å»ºCIFAR-10ç½‘ç»œ
SimpleConvNet convNet = SimpleConvNet.buildCifar10ConvNet();
System.out.println("âœ“ CIFAR-10ç½‘ç»œæ„å»ºæˆåŠŸ");

// åˆ›å»ºæ¨¡æ‹Ÿè¾“å…¥æ•°æ® (batch_size=2, channels=3, height=32, width=32)
Shape inputShape = Shape.of(2, 3, 32, 32);
NdArray inputData = NdArray.likeRandomN(inputShape);
Variable input = new Variable(inputData);
```

### è‡ªå®šä¹‰ç½‘ç»œé…ç½®

SimpleConvNetè¿˜æ”¯æŒå®Œå…¨è‡ªå®šä¹‰çš„ç½‘ç»œé…ç½®ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„è¾“å…¥å°ºå¯¸å’Œä»»åŠ¡éœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼š

```java
// æ„å»ºè‡ªå®šä¹‰ç½‘ç»œ (64x64 RGBå›¾åƒï¼Œ5ä¸ªç±»åˆ«)
SimpleConvNet convNet = SimpleConvNet.buildCustomConvNet(
    "CustomNet", 3, 64, 64, 5);
System.out.println("âœ“ è‡ªå®šä¹‰ç½‘ç»œæ„å»ºæˆåŠŸ");
```

**ç« èŠ‚æ¥æº**
- [SimpleConvNetExample.java](file://tinyai-deeplearning-case/src/main/java/io/leavesfly/tinyai/example/cv/SimpleConvNetExample.java#L0-L151)
- [SimpleConvNet.java](file://tinyai-deeplearning-nnet/src/main/java/io/leavesfly/tinyai/nnet/block/SimpleConvNet.java#L274-L348)

## è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹ - GPT2

GPT2Demoå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨TinyAIæ¡†æ¶æ„å»ºå’Œè®­ç»ƒGPT-2è¯­è¨€æ¨¡å‹ï¼Œæ¶µç›–æ–‡æœ¬æ•°æ®é¢„å¤„ç†ã€æ¨¡å‹è®­ç»ƒå’Œæ–‡æœ¬ç”Ÿæˆçš„å®Œæ•´æµç¨‹ã€‚

### æ–‡æœ¬æ•°æ®é¢„å¤„ç†

GPT2Demoé¦–å…ˆåˆ›å»ºåˆ†è¯å™¨å¹¶æ„å»ºè¯æ±‡è¡¨ï¼š

```mermaid
flowchart TD
Start["å¼€å§‹æ–‡æœ¬é¢„å¤„ç†"] --> LoadText["åŠ è½½è®­ç»ƒæ–‡æœ¬"]
LoadText --> BuildVocab["æ„å»ºè¯æ±‡è¡¨<br/>æœ€å°é¢‘ç‡: 1<br/>æœ€å¤§è¯æ±‡è¡¨: 1000"]
BuildVocab --> Tokenize["æ–‡æœ¬åˆ†è¯"]
Tokenize --> PadSeq["åºåˆ—å¡«å……<br/>æœ€å¤§é•¿åº¦: 64"]
PadSeq --> CreateDataset["åˆ›å»ºè®­ç»ƒæ•°æ®é›†"]
CreateDataset --> End["é¢„å¤„ç†å®Œæˆ"]
```

**å›¾è¡¨æ¥æº**
- [GPT2Demo.java](file://tinyai-model-gpt/src/main/java/io/leavesfly/tinyai/gpt2/GPT2Demo.java#L14-L94)

#### æ¨¡å‹åˆ›å»ºä¸åˆå§‹åŒ–

```java
// åˆ›å»ºå°å‹GPT-2æ¨¡å‹
GPT2Model model = GPT2Model.createSmallModel("demo_gpt2");

// æ‰“å°æ¨¡å‹ä¿¡æ¯
model.printModelInfo();

// éªŒè¯è¾“å…¥
model.validateInput(inputTokens);
System.out.println("âœ“ è¾“å…¥éªŒè¯é€šè¿‡");
```

#### å‰å‘ä¼ æ’­ä¸é¢„æµ‹

```java
// å‰å‘ä¼ æ’­
Variable output = model.predict(inputTokens);
System.out.println("è¾“å‡ºå½¢çŠ¶: " + output.getValue().getShape());
System.out.println("âœ“ å‰å‘ä¼ æ’­æˆåŠŸ");

// é¢„æµ‹ä¸‹ä¸€ä¸ªtoken
int predictedToken = model.predictNextToken(inputTokens);
System.out.println("é¢„æµ‹çš„ä¸‹ä¸€ä¸ªtoken ID: " + predictedToken);
System.out.println("âœ“ tokené¢„æµ‹æˆåŠŸ");
```

#### åºåˆ—ç”Ÿæˆ

```java
// ç”Ÿæˆåºåˆ—
NdArray generatedSeq = model.generateSequence(startTokens, 5);
System.out.println("ç”Ÿæˆåºåˆ—å½¢çŠ¶: " + generatedSeq.getShape());

// æ‰“å°ç”Ÿæˆçš„åºåˆ—
System.out.print("ç”Ÿæˆçš„åºåˆ—: [");
for (int i = 0; i < generatedSeq.getShape().getDimension(1); i++) {
    System.out.print((int)generatedSeq.get(0, i));
    if (i < generatedSeq.getShape().getDimension(1) - 1) {
        System.out.print(", ");
    }
}
System.out.println("]");
System.out.println("âœ“ åºåˆ—ç”ŸæˆæˆåŠŸ");
```

**ç« èŠ‚æ¥æº**
- [GPT2Demo.java](file://tinyai-model-gpt/src/main/java/io/leavesfly/tinyai/gpt2/GPT2Demo.java#L0-L94)

## è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹ - GPT3

GPT3Demoå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨TinyAIæ¡†æ¶æ„å»ºå’Œè®­ç»ƒGPT-3è¯­è¨€æ¨¡å‹ï¼Œæ¶µç›–æ¨¡å‹åˆ›å»ºã€æ¶æ„åˆ†æã€å‰å‘ä¼ æ’­ã€æ–‡æœ¬ç”Ÿæˆå’ŒFew-shotå­¦ä¹ çš„å®Œæ•´æµç¨‹ã€‚

### æ¨¡å‹åˆ›å»ºæ¼”ç¤º

GPT3Demoæ”¯æŒåˆ›å»ºä¸åŒè§„æ¨¡çš„GPT-3æ¨¡å‹ï¼š

```java
// åˆ›å»ºå°å‹GPT-3æ¨¡å‹ï¼ˆ125Må‚æ•°ï¼‰
GPT3Model smallModel = GPT3Model.createSmallModel("gpt3-small");
System.out.println("âœ“ å°å‹æ¨¡å‹åˆ›å»ºæˆåŠŸ");

// åˆ›å»ºä¸­å‹GPT-3æ¨¡å‹ï¼ˆ350Må‚æ•°ï¼‰
GPT3Model mediumModel = GPT3Model.createMediumModel("gpt3-medium");
System.out.println("âœ“ ä¸­å‹æ¨¡å‹åˆ›å»ºæˆåŠŸ");

// åˆ›å»ºå¤§å‹GPT-3æ¨¡å‹ï¼ˆ1.3Bå‚æ•°ï¼‰
GPT3Model largeModel = GPT3Model.createLargeModel("gpt3-large");
System.out.println("âœ“ å¤§å‹æ¨¡å‹åˆ›å»ºæˆåŠŸ");
```

**ç« èŠ‚æ¥æº**
- [GPT3Demo.java](file://tinyai-model-gpt/src/main/java/io/leavesfly/tinyai/gpt3/GPT3Demo.java#L19-L386)

### æ¨¡å‹æ¶æ„åˆ†æ

GPT3Demoæä¾›äº†è¯¦ç»†çš„æ¶æ„åˆ†æåŠŸèƒ½ï¼š

```mermaid
graph TD
A[GPT-3æ¶æ„] --> B[è§£ç å™¨-only Transformer]
A --> C[Pre-LayerNormç»“æ„]
A --> D[å¹¶è¡Œæ³¨æ„åŠ›å’ŒMLPè®¡ç®—]
A --> E[æ—‹è½¬ä½ç½®ç¼–ç (RoPE)]
A --> F[ç¨€ç–æ³¨æ„åŠ›æœºåˆ¶]
A --> G[Few-shotå­¦ä¹ èƒ½åŠ›]
```

**å›¾è¡¨æ¥æº**
- [GPT3Demo.java](file://tinyai-model-gpt/src/main/java/io/leavesfly/tinyai/gpt3/GPT3Demo.java#L19-L386)

#### æ¶æ„ç‰¹æ€§

```java
System.out.println("ğŸ“Š GPT-3å…³é”®ç‰¹æ€§:");
System.out.println("â€¢ è§£ç å™¨-only Transformeræ¶æ„");
System.out.println("â€¢ Pre-LayerNormç»“æ„");
System.out.println("â€¢ å¹¶è¡Œæ³¨æ„åŠ›å’ŒMLPè®¡ç®—");
System.out.println("â€¢ æ—‹è½¬ä½ç½®ç¼–ç (RoPE)");
System.out.println("â€¢ ç¨€ç–æ³¨æ„åŠ›æœºåˆ¶ï¼ˆå¤§å‹æ¨¡å‹ï¼‰");
System.out.println("â€¢ å¼ºå¤§çš„Few-shotå­¦ä¹ èƒ½åŠ›");
```

### å‰å‘ä¼ æ’­æ¼”ç¤º

GPT3Demoå±•ç¤ºäº†å®Œæ•´çš„å‰å‘ä¼ æ’­æµç¨‹ï¼š

```java
// åˆ›å»ºç¤ºä¾‹è¾“å…¥
NdArray inputTokens = NdArray.of(Shape.of(batchSize, seqLen));

// æ‰§è¡Œå‰å‘ä¼ æ’­
Variable output = model.forward(new Variable(inputTokens));

// éªŒè¯è¾“å‡ºå½¢çŠ¶
Shape expectedShape = Shape.of(batchSize, seqLen, config.getVocabSize());
if (outputData.getShape().equals(expectedShape)) {
    System.out.println("âœ“ è¾“å‡ºå½¢çŠ¶éªŒè¯é€šè¿‡");
}
```

### æ–‡æœ¬ç”Ÿæˆæ¼”ç¤º

GPT3Demoå±•ç¤ºäº†æ–‡æœ¬ç”Ÿæˆèƒ½åŠ›ï¼š

```java
// ç”Ÿæˆæ–‡æœ¬
NdArray generated = model.generateSequence(startTokens, maxLength);
System.out.println("ç”Ÿæˆç»“æœ: " + arrayToString(generated));

// å•æ­¥é¢„æµ‹
int nextToken = model.predictNextToken(testSeq);
System.out.println("è¾“å…¥: " + arrayToString(testSeq) + " -> é¢„æµ‹: " + nextToken);
```

### Few-shotå­¦ä¹ æ¼”ç¤º

GPT3Demoå±•ç¤ºäº†Few-shotå­¦ä¹ èƒ½åŠ›ï¼š

```java
// åˆ›å»ºFew-shotä¸Šä¸‹æ–‡
NdArray context = NdArray.of(Shape.of(1, 20));

// åŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆ
NdArray fewShotResult = model.fewShotGenerate(context, maxNewTokens);

System.out.println("ğŸ’¡ Few-shotå­¦ä¹ ä¼˜åŠ¿:");
System.out.println("â€¢ æ— éœ€å¾®è°ƒå³å¯é€‚åº”æ–°ä»»åŠ¡");
System.out.println("â€¢ é€šè¿‡ç¤ºä¾‹å¿«é€Ÿç†è§£ä»»åŠ¡æ¨¡å¼");
System.out.println("â€¢ æ”¯æŒå¤šç§ä»»åŠ¡ç±»å‹");
System.out.println("â€¢ å±•ç°å¼ºå¤§çš„æ³›åŒ–èƒ½åŠ›");
```

### æ—‹è½¬ä½ç½®ç¼–ç æ¼”ç¤º

GPT3Demoå±•ç¤ºäº†æ—‹è½¬ä½ç½®ç¼–ç çš„å®ç°ï¼š

```java
// åˆ›å»ºæ—‹è½¬ä½ç½®ç¼–ç 
GPT3RotaryEmbedding rope = new GPT3RotaryEmbedding("demo_rope", rotaryDim, maxSeqLen);

// ç”Ÿæˆä½ç½®ç¼–ç 
NdArray[] cosAndSin = rope.generateRotaryEmbedding(testSeqLen);

// åº”ç”¨æ—‹è½¬å˜æ¢
Variable[] rotated = rope.applyRotaryPositionEmbedding(
    new Variable(testQuery), new Variable(testKey), testSeqLen
);

System.out.println("ğŸ” RoPEä¼˜åŠ¿:");
System.out.println("â€¢ ç›¸å¯¹ä½ç½®ç¼–ç ç‰¹æ€§");
System.out.println("â€¢ æ”¯æŒä»»æ„é•¿åº¦åºåˆ—");
System.out.println("â€¢ ä¸å¢åŠ å‚æ•°é‡");
System.out.println("â€¢ ä¿æŒå‘é‡æ¨¡é•¿ä¸å˜");
```

## è‡ªç„¶è¯­è¨€å¤„ç†ç¤ºä¾‹ - Qwen3

Qwen3Demoå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨åŸºäºTinyAIæ¶æ„å®ç°çš„Qwen3å¤§è¯­è¨€æ¨¡å‹ï¼Œæ¶µç›–åŸºæœ¬ä½¿ç”¨ã€æ¶æ„åˆ†æå’Œæ–‡æœ¬ç”Ÿæˆã€‚

### åŸºæœ¬ä½¿ç”¨æ¼”ç¤º

Qwen3Demoå±•ç¤ºäº†æ¨¡å‹çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼š

```java
// åˆ›å»ºå°å‹Qwen3æ¨¡å‹
Qwen3Model model = Qwen3Model.createTinyModel("demo_qwen3");
System.out.println("âœ“ åˆ›å»ºäº†å°å‹Qwen3æ¨¡å‹");

// å‡†å¤‡è¾“å…¥æ•°æ®
NdArray inputIds = NdArray.of(new float[]{1, 15, 25, 35, 45});
System.out.println("âœ“ å‡†å¤‡äº†è¾“å…¥åºåˆ—");

// å‰å‘ä¼ æ’­
Variable logits = model.forwardWithLogits(new Variable(inputIds));
System.out.println("âœ“ å‰å‘ä¼ æ’­å®Œæˆï¼Œè¾“å‡ºå½¢çŠ¶: " + outputShape);

// é¢„æµ‹ä¸‹ä¸€ä¸ªtoken
int nextToken = model.predictNextToken(inputIds);
System.out.println("âœ“ é¢„æµ‹çš„ä¸‹ä¸€ä¸ªtoken ID: " + nextToken);
```

**ç« èŠ‚æ¥æº**
- [Qwen3Demo.java](file://tinyai-model-qwen/src/main/java/io/leavesfly/tinyai/qwen3/Qwen3Demo.java#L14-L143)

### æ¨¡å‹æ¶æ„æ¼”ç¤º

Qwen3Demoå±•ç¤ºäº†æ¨¡å‹çš„æ¶æ„ç‰¹æ€§ï¼š

```java
// æ‰“å°æ¨¡å‹ä¿¡æ¯
model.printModelInfo();

// å±•ç¤ºé…ç½®è¯¦æƒ…
Qwen3Config config = model.getConfig();
System.out.println("\nè¯¦ç»†é…ç½®:");
System.out.println("- æ¯ä¸ªæ³¨æ„åŠ›å¤´ç»´åº¦: " + config.getHeadDim());
System.out.println("- KVå¤´åˆ†ç»„æ•°: " + config.getNumKeyValueGroups());
System.out.println("- RoPEåŸºç¡€é¢‘ç‡: " + config.getRopeTheta());
System.out.println("- RMSNorm epsilon: " + config.getRmsNormEps());
```

### æ–‡æœ¬ç”Ÿæˆæ¼”ç¤º

Qwen3Demoå±•ç¤ºäº†æ–‡æœ¬ç”Ÿæˆèƒ½åŠ›ï¼š

```java
// å•åºåˆ—ç”Ÿæˆ
NdArray prompt = NdArray.of(new float[]{10, 20, 30});
NdArray generated = model.generate(prompt, 10);
System.out.println("ç”Ÿæˆåºåˆ—: " + arrayToString(generated));

// æ‰¹æ¬¡ç”Ÿæˆ
NdArray batchPrompt = NdArray.of(Shape.of(2, 3));
NdArray batchGenerated = model.generate(batchPrompt, 8);
System.out.println("æ‰¹æ¬¡ç”Ÿæˆ:");
printBatchArray(batchGenerated);
```

## å¼ºåŒ–å­¦ä¹ ç¤ºä¾‹ - CartPoleDQN

CartPoleDQNExampleå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ·±åº¦Qç½‘ç»œï¼ˆDQNï¼‰ç®—æ³•è§£å†³CartPoleï¼ˆå€’ç«‹æ‘†ï¼‰æ§åˆ¶é—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„å¼ºåŒ–å­¦ä¹ ç¯å¢ƒï¼Œç›®æ ‡æ˜¯é€šè¿‡æ§åˆ¶å°è½¦çš„å·¦å³ç§»åŠ¨æ¥å¹³è¡¡æ†å­ã€‚

### CartPoleç¯å¢ƒä»‹ç»

CartPoleç¯å¢ƒæ˜¯ä¸€ä¸ªè¿ç»­æ§åˆ¶é—®é¢˜ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

```mermaid
graph TB
subgraph "CartPoleç¯å¢ƒçŠ¶æ€ç©ºé—´"
State["çŠ¶æ€å‘é‡<br/>4ç»´"]
State --> X["ä½ç½® x"]
State --> XDot["é€Ÿåº¦ x_dot"]
State --> Theta["è§’åº¦ theta"]
State --> ThetaDot["è§’é€Ÿåº¦ theta_dot"]
end
subgraph "åŠ¨ä½œç©ºé—´"
Action["åŠ¨ä½œå‘é‡<br/>2ç»´"]
Action --> Left["å‘å·¦æ¨åŠ›"]
Action --> Right["å‘å³æ¨åŠ›"]
end
subgraph "å¥–åŠ±æœºåˆ¶"
Reward["å³æ—¶å¥–åŠ±"]
Reward --> StepReward["æ¯æ­¥+1"]
Reward --> FallReward["å€’ä¸‹æ—¶ç»ˆæ­¢"]
end
State --> Action
Action --> State
State --> Reward
```

**å›¾è¡¨æ¥æº**
- [CartPoleEnvironment.java](file://tinyai-deeplearning-rl/src/main/java/io/leavesfly/tinyai/rl/environment/CartPoleEnvironment.java#L0-L80)

### DQNç®—æ³•å®ç°

CartPoleDQNExampleå±•ç¤ºäº†å®Œæ•´çš„DQNç®—æ³•å®ç°ï¼ŒåŒ…æ‹¬ç»éªŒå›æ”¾ã€ç›®æ ‡ç½‘ç»œå’ŒÎµ-greedyç­–ç•¥ï¼š

```mermaid
sequenceDiagram
participant Env as "CartPoleç¯å¢ƒ"
participant Agent as "DQNæ™ºèƒ½ä½“"
participant ReplayBuffer as "ç»éªŒå›æ”¾ç¼“å†²åŒº"
participant QNetwork as "Qç½‘ç»œ"
participant TargetNetwork as "ç›®æ ‡ç½‘ç»œ"
loop æ¯ä¸ªepisode
Env->>Agent : é‡ç½®ç¯å¢ƒçŠ¶æ€
Agent->>Env : é€‰æ‹©åŠ¨ä½œ
Env->>Agent : è¿”å›æ–°çŠ¶æ€ã€å¥–åŠ±ã€doneæ ‡å¿—
Agent->>ReplayBuffer : å­˜å‚¨ç»éªŒ(s,a,r,s',done)
alt ç»éªŒè¶³å¤Ÿ
Agent->>ReplayBuffer : é‡‡æ ·æ‰¹æ¬¡
ReplayBuffer->>Agent : è¿”å›ç»éªŒæ‰¹æ¬¡
Agent->>QNetwork : è®¡ç®—å½“å‰Qå€¼
Agent->>TargetNetwork : è®¡ç®—ç›®æ ‡Qå€¼
Agent->>QNetwork : æ›´æ–°ç½‘ç»œå‚æ•°
end
alt è¾¾åˆ°ç›®æ ‡ç½‘ç»œæ›´æ–°é¢‘ç‡
Agent->>TargetNetwork : åŒæ­¥ç›®æ ‡ç½‘ç»œ
end
end
```

**å›¾è¡¨æ¥æº**
- [CartPoleDQNExample.java](file://tinyai-deeplearning-case/src/main/java/io/leavesfly/tinyai/example/rl/CartPoleDQNExample.java#L71-L103)

### æ™ºèƒ½ä½“åˆ›å»ºä¸é…ç½®

```java
private static DQNAgent createDQNAgent(Environment env) {
    // ç½‘ç»œå‚æ•°
    int stateDim = env.getStateDim();           // çŠ¶æ€ç»´åº¦ï¼š4
    int actionDim = env.getActionDim();         // åŠ¨ä½œç»´åº¦ï¼š2
    int[] hiddenSizes = {128, 128};             // éšè—å±‚å°ºå¯¸
    
    // ç®—æ³•å‚æ•°
    float learningRate = 0.001f;                // å­¦ä¹ ç‡
    float epsilon = 1.0f;                       // åˆå§‹æ¢ç´¢ç‡
    float gamma = 0.99f;                        // æŠ˜æ‰£å› å­
    int batchSize = 32;                         // æ‰¹æ¬¡å¤§å°
    int bufferSize = 10000;                     // ç»éªŒå›æ”¾ç¼“å†²åŒºå¤§å°
    int targetUpdateFreq = 100;                 // ç›®æ ‡ç½‘ç»œæ›´æ–°é¢‘ç‡
    
    return new DQNAgent(
            "CartPole_DQN",
            stateDim, actionDim, hiddenSizes,
            learningRate, epsilon, gamma,
            batchSize, bufferSize, targetUpdateFreq
    );
}
```

### è®­ç»ƒè¿‡ç¨‹ç›‘æ§

CartPoleDQNExampleæä¾›äº†è¯¦ç»†çš„è®­ç»ƒè¿‡ç¨‹ç›‘æ§ï¼ŒåŒ…æ‹¬ï¼š

```java
// æ‰“å°è®­ç»ƒè¿›åº¦
if (episode % 50 == 0 || episode == numEpisodes - 1) {
    Map<String, Object> stats = agent.getTrainingStats();
    System.out.printf("Episode %d: å¥–åŠ±=%.2f, æ­¥æ•°=%d, Epsilon=%.3f, æŸå¤±=%.6f, ç¼“å†²åŒºä½¿ç”¨ç‡=%.2f%%\n",
            episode, episodeReward, steps,
            (Float) stats.get("epsilon"),
            (Float) stats.get("average_loss"),
            (Float) stats.get("buffer_usage") * 100);
}
```

### æ€§èƒ½è¯„ä¼°

```java
private static void evaluateAgent(DQNAgent agent, Environment env, int numEvaluationEpisodes) {
    // åˆ‡æ¢åˆ°è¯„ä¼°æ¨¡å¼
    agent.setTraining(false);
    
    float totalReward = 0.0f;
    int totalSteps = 0;
    int successfulEpisodes = 0;
    
    for (int episode = 0; episode < numEvaluationEpisodes; episode++) {
        Variable state = env.reset();
        float episodeReward = 0.0f;
        int steps = 0;
        
        for (int step = 0; step < 500; step++) {
            Variable action = agent.selectAction(state);
            Environment.StepResult result = env.step(action);
            
            state = result.getNextState();
            episodeReward += result.getReward();
            steps++;
            
            if (result.isDone()) {
                break;
            }
        }
        
        totalReward += episodeReward;
        totalSteps += steps;
        
        if (episodeReward >= 450) { // è®¤ä¸º450+æ­¥ä¸ºæˆåŠŸ
            successfulEpisodes++;
        }
    }
    
    // è®¡ç®—å¹³å‡æ€§èƒ½
    float averageReward = totalReward / numEvaluationEpisodes;
    float successRate = (float) successfulEpisodes / numEvaluationEpisodes * 100;
    
    System.out.println("è¯„ä¼°ç»“æœ:");
    System.out.printf("  å¹³å‡å¥–åŠ±: %.2f\n", averageReward);
    System.out.printf("  æˆåŠŸç‡: %.1f%% (%d/%d)\n", successRate, successfulEpisodes, numEvaluationEpisodes);
}
```

**ç« èŠ‚æ¥æº**
- [CartPoleDQNExample.java](file://tinyai-deeplearning-case/src/main/java/io/leavesfly/tinyai/example/rl/CartPoleDQNExample.java#L0-L241)

## æœ€ä½³å®è·µæŒ‡å—

### è®¡ç®—æœºè§†è§‰æœ€ä½³å®è·µ

1. **æ•°æ®é¢„å¤„ç†**
   - ç¡®ä¿è¾“å…¥å›¾åƒå°ºå¯¸ä¸ç½‘ç»œæœŸæœ›ä¸€è‡´
   - ä½¿ç”¨é€‚å½“çš„å½’ä¸€åŒ–æ–¹æ³•
   - è€ƒè™‘æ•°æ®å¢å¼ºæŠ€æœ¯æé«˜æ³›åŒ–èƒ½åŠ›

2. **ç½‘ç»œé…ç½®**
   - æ ¹æ®è¾“å…¥å°ºå¯¸è‡ªåŠ¨è°ƒæ•´Dropoutç‡
   - ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–æå‡è®­ç»ƒç¨³å®šæ€§
   - åˆç†è®¾ç½®å·ç§¯æ ¸å¤§å°å’Œæ­¥é•¿

3. **è®­ç»ƒç›‘æ§**
   - å®šæœŸä¿å­˜æ¨¡å‹æƒé‡
   - ç›‘æ§è®­ç»ƒå’ŒéªŒè¯æŸå¤±æ›²çº¿
   - ä½¿ç”¨æ—©åœæœºåˆ¶é˜²æ­¢è¿‡æ‹Ÿåˆ

### è‡ªç„¶è¯­è¨€å¤„ç†æœ€ä½³å®è·µ

1. **æ–‡æœ¬é¢„å¤„ç†**
   - é€‰æ‹©åˆé€‚çš„è¯æ±‡è¡¨å¤§å°
   - å¤„ç†æœªçŸ¥è¯å’Œç‰¹æ®Šæ ‡è®°
   - è€ƒè™‘ä½¿ç”¨å­è¯åˆ†å‰²æŠ€æœ¯

2. **æ¨¡å‹æ¶æ„**
   - æ ¹æ®ä»»åŠ¡å¤æ‚åº¦è°ƒæ•´æ¨¡å‹å¤§å°
   - ä½¿ç”¨é€‚å½“çš„ä½ç½®ç¼–ç 
   - è€ƒè™‘ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶

3. **è®­ç»ƒç­–ç•¥**
   - ä½¿ç”¨å­¦ä¹ ç‡è°ƒåº¦å™¨
   - å®æ–½æ¢¯åº¦è£å‰ªé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸
   - ç›‘æ§ç”Ÿæˆæ–‡æœ¬çš„è´¨é‡

### å¼ºåŒ–å­¦ä¹ æœ€ä½³å®è·µ

1. **ç¯å¢ƒè®¾è®¡**
   - ç¡®ä¿å¥–åŠ±ä¿¡å·æ¸…æ™°ä¸”åŠæ—¶
   - è®¾è®¡åˆç†çš„çŠ¶æ€å’ŒåŠ¨ä½œç©ºé—´
   - è€ƒè™‘ä½¿ç”¨å¥–åŠ±å¡‘å½¢æŠ€æœ¯

2. **ç®—æ³•è°ƒä¼˜**
   - åˆç†è®¾ç½®æ¢ç´¢ç‡è¡°å‡ç­–ç•¥
   - é€‰æ‹©åˆé€‚çš„ç»éªŒå›æ”¾ç¼“å†²åŒºå¤§å°
   - ä½¿ç”¨ç›®æ ‡ç½‘ç»œç¨³å®šè®­ç»ƒ

3. **æ€§èƒ½è¯„ä¼°**
   - å¤šæ¬¡è¿è¡Œå–å¹³å‡ç»“æœ
   - å…³æ³¨é•¿æœŸæ€§èƒ½è€ŒéçŸ­æœŸå¥–åŠ±
   - ä½¿ç”¨å¯è§†åŒ–å·¥å…·åˆ†ææ™ºèƒ½ä½“è¡Œä¸º

## å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

### è®¡ç®—æœºè§†è§‰å¸¸è§é—®é¢˜

1. **è¾“å…¥å°ºå¯¸ä¸åŒ¹é…**
   ```java
   // é”™è¯¯ï¼šè¾“å…¥å°ºå¯¸ä¸ç½‘ç»œæœŸæœ›ä¸ç¬¦
   Shape inputShape = Shape.of(2, 1, 32, 32); // åº”è¯¥æ˜¯28x28
   
   // æ­£ç¡®ï¼šä½¿ç”¨æ­£ç¡®çš„è¾“å…¥å°ºå¯¸
   Shape inputShape = Shape.of(2, 1, 28, 28);
   ```

2. **å†…å­˜ä¸è¶³**
   ```java
   // é—®é¢˜ï¼šæ‰¹æ¬¡å¤§å°è¿‡å¤§å¯¼è‡´å†…å­˜æº¢å‡º
   // è§£å†³ï¼šå‡å°æ‰¹æ¬¡å¤§å°æˆ–ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯
   
   int batchSize = 32; // å¯ä»¥å°è¯•å‡å°åˆ°16æˆ–æ›´å°
   ```

### è‡ªç„¶è¯­è¨€å¤„ç†å¸¸è§é—®é¢˜

1. **è¯æ±‡è¡¨å¤§å°é—®é¢˜**
   ```java
   // é—®é¢˜ï¼šè¯æ±‡è¡¨å¤ªå°å¯¼è‡´OOVé—®é¢˜
   tokenizer.buildVocab(texts, 1, 500); // è¯æ±‡è¡¨å¯èƒ½å¤ªå°
   
   // è§£å†³ï¼šå¢åŠ è¯æ±‡è¡¨å¤§å°
   tokenizer.buildVocab(texts, 1, 1000); // æ›´å¤§çš„è¯æ±‡è¡¨
   ```

2. **åºåˆ—é•¿åº¦æˆªæ–­**
   ```java
   // é—®é¢˜ï¼šé•¿æ–‡æœ¬è¢«æˆªæ–­ä¸¢å¤±ä¿¡æ¯
   // è§£å†³ï¼šä½¿ç”¨æ»‘åŠ¨çª—å£æˆ–åŠ¨æ€æˆªæ–­
   
   int maxLength = 64; // å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´
   ```

### å¼ºåŒ–å­¦ä¹ å¸¸è§é—®é¢˜

1. **å¥–åŠ±ç¨€ç–**
   ```java
   // é—®é¢˜ï¼šå¥–åŠ±ä¿¡å·è¿‡äºç¨€ç–
   // è§£å†³ï¼šè®¾è®¡æ›´å¯†é›†çš„å¥–åŠ±å‡½æ•°
   
   float reward = 1.0f; // æ¯æ­¥+1å¥–åŠ±
   if (done) {
       reward = -10.0f; // å€’ä¸‹æ—¶ç»™äºˆæƒ©ç½š
   }
   ```

2. **æ¢ç´¢ä¸è¶³**
   ```java
   // é—®é¢˜ï¼šæ™ºèƒ½ä½“è¿‡æ—©æ”¶æ•›åˆ°æ¬¡ä¼˜ç­–ç•¥
   // è§£å†³ï¼šå®æ–½æ›´å¥½çš„æ¢ç´¢ç­–ç•¥
   
   float epsilon = 1.0f; // åˆå§‹æ¢ç´¢ç‡è¾ƒé«˜
   float epsilonDecay = 0.995f; // æ¯æ­¥è¡°å‡æ¢ç´¢ç‡
   ```

## æ€»ç»“

TinyAIæ¡†æ¶çš„åº”ç”¨ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨è®¡ç®—æœºè§†è§‰ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œå¼ºåŒ–å­¦ä¹ é¢†åŸŸæ„å»ºå’Œè®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚é€šè¿‡SimpleConvNetExampleã€GPT2Demoã€GPT3Demoã€Qwen3Demoå’ŒCartPoleDQNExampleï¼Œå¼€å‘è€…å¯ä»¥ï¼š

1. **ç†è§£æ ¸å¿ƒæ¦‚å¿µ**ï¼šæŒæ¡å·ç§¯ç¥ç»ç½‘ç»œã€è¯­è¨€æ¨¡å‹å’Œæ·±åº¦å¼ºåŒ–å­¦ä¹ çš„åŸºæœ¬åŸç†
2. **å­¦ä¹ æœ€ä½³å®è·µ**ï¼šè·å¾—æ•°æ®é¢„å¤„ç†ã€æ¨¡å‹è®­ç»ƒå’Œæ€§èƒ½è¯„ä¼°çš„æœ€ä½³å®è·µæŒ‡å¯¼
3. **é¿å…å¸¸è§é”™è¯¯**ï¼šè¯†åˆ«å¹¶è§£å†³åœ¨å®é™…å¼€å‘ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜
4. **æ‰©å±•åº”ç”¨èŒƒå›´**ï¼šåŸºäºç¤ºä¾‹ä»£ç è¿›è¡Œä¿®æ”¹å’Œæ‰©å±•ï¼Œæ»¡è¶³ç‰¹å®šéœ€æ±‚

è¿™äº›ç¤ºä¾‹ä¸ä»…æä¾›äº†ç†è®ºçŸ¥è¯†çš„å®é™…åº”ç”¨ï¼Œè¿˜å±•ç¤ºäº†å¦‚ä½•åœ¨çœŸå®åœºæ™¯ä¸­ä½¿ç”¨TinyAIæ¡†æ¶æ„å»ºé«˜è´¨é‡çš„æœºå™¨å­¦ä¹ ç³»ç»Ÿã€‚é€šè¿‡æ·±å…¥ç†è§£å’Œå®è·µè¿™äº›ç¤ºä¾‹ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨TinyAIçš„å¼ºå¤§åŠŸèƒ½ï¼Œæ¨åŠ¨äººå·¥æ™ºèƒ½æŠ€æœ¯çš„å‘å±•å’Œåº”ç”¨ã€‚