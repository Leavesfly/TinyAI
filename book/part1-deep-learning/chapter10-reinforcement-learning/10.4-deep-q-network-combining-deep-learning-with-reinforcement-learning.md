# 10.4 æ·±åº¦Qç½‘ç»œ(DQN): æ·±åº¦å­¦ä¹ é‡è§å¼ºåŒ–å­¦ä¹ 

> **æœ¬èŠ‚å­¦ä¹ ç›®æ ‡**: æŒæ¡DQNçš„æ ¸å¿ƒæŠ€æœ¯,ç†è§£å¦‚ä½•ç”¨ç¥ç»ç½‘ç»œçªç ´Qè¡¨çš„é™åˆ¶,å­¦ä¼šç»éªŒå›æ”¾å’Œç›®æ ‡ç½‘ç»œçš„ç²¾é«“

## å†…å®¹æ¦‚è§ˆ

å¦‚æœè¯´Q-Learningæ˜¯ç”¨"å°æœ¬æœ¬"è®°å½•ç»éªŒ,é‚£ä¹ˆDQNå°±æ˜¯ç”¨"å¤§è„‘"æ¥å­¦ä¹ !DQNæ˜¯å¼ºåŒ–å­¦ä¹ é¢†åŸŸçš„é‡Œç¨‹ç¢‘,å®ƒè®©AIå­¦ä¼šäº†ç©Atariæ¸¸æˆ,ç”šè‡³è¶…è¶Šäººç±»ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†æ­ç§˜DQNçš„ä¸‰å¤§æ³•å®ã€‚

## 10.4.1 ä»Qè¡¨åˆ°ç¥ç»ç½‘ç»œ: ä¸€æ¬¡é©å‘½æ€§é£è·ƒ

### Q-Learningçš„å›°å¢ƒ

æƒ³è±¡ä½ åœ¨å­¦ä¹ å›´æ£‹:
- **Qè¡¨æ–¹æ³•**: ä¸ºæ¯ä¸ªæ£‹ç›˜å±€é¢è®°å½•ä¸€ä¸ªåˆ†æ•°
- **é—®é¢˜**: å›´æ£‹æœ‰10^170ç§å±€é¢,å®‡å®™åŸå­æ‰10^80ä¸ª!

```mermaid
graph TB
    Problem[Qè¡¨çš„ç»´åº¦ç¾éš¾]
    
    Problem --> P1[äº•å­—æ£‹<br/>3Ã—3=9ä¸ªä½ç½®<br/>Qè¡¨: 3^9 â‰ˆ 2ä¸‡é¡¹]
    Problem --> P2[äº”å­æ£‹<br/>15Ã—15=225ä¸ªä½ç½®<br/>Qè¡¨: 3^225 â‰ˆ å¤©æ–‡æ•°å­—]
    Problem --> P3[Atariæ¸¸æˆ<br/>210Ã—160åƒç´ <br/>Qè¡¨: æ— æ³•å­˜å‚¨]
    
    P1 --> S1[âœ“ å¯è¡Œ]
    P2 --> S2[âœ— ä¸å¯è¡Œ]
    P3 --> S3[âœ— ä¸å¯è¡Œ]
    
    style Problem fill:#ffebee
    style P1 fill:#c8e6c9
    style P2 fill:#ffccbc
    style P3 fill:#ffccbc
    style S1 fill:#81c784
    style S2 fill:#e57373
    style S3 fill:#e57373
```

### DQNçš„çªç ´æ€§æ€æƒ³

**æ ¸å¿ƒåˆ›æ„**: ç”¨ç¥ç»ç½‘ç»œæ¥"è¿‘ä¼¼"Qå‡½æ•°

```mermaid
graph LR
    subgraph Q-Learningä¼ ç»Ÿæ–¹æ³•
        S1[çŠ¶æ€] --> T[æŸ¥Qè¡¨] --> Q1[Qå€¼]
    end
    
    subgraph DQNæ–¹æ³•
        S2[çŠ¶æ€] --> N[ç¥ç»ç½‘ç»œ] --> Q2[Qå€¼]
    end
    
    T -.çŠ¶æ€å¤šæ—¶.-> L[è¡¨å¤ªå¤§]
    N -.è‡ªåŠ¨æ³›åŒ–.-> A[å¯å¤„ç†æœªè§çŠ¶æ€]
    
    style T fill:#ffccbc
    style N fill:#c8e6c9
    style L fill:#e57373
    style A fill:#81c784
```

### ç”Ÿæ´»ç±»æ¯”: æŸ¥å­—å…¸ vs ç†è§£è¯­è¨€

**Qè¡¨**: åƒæŸ¥å­—å…¸
- è§è¿‡çš„è¯: èƒ½æŸ¥åˆ°æ„æ€ âœ“
- æ²¡è§è¿‡çš„è¯: æŸ¥ä¸åˆ° âœ—

**DQN**: åƒç†è§£è¯­è¨€
- è§è¿‡çš„å¥å­: èƒ½ç†è§£ âœ“
- æ²¡è§è¿‡çš„å¥å­: æ ¹æ®è¯­æ³•æ¨æµ‹ âœ“

```mermaid
graph TB
    Compare[Qè¡¨ vs DQN]
    
    Compare --> Q[Qè¡¨æ–¹æ³•<br/>å°±åƒæ­»è®°ç¡¬èƒŒ]
    Compare --> D[DQNæ–¹æ³•<br/>å°±åƒç†è§£åŸç†]
    
    Q --> Q1[ä¼˜ç‚¹: å‡†ç¡®<br/>ç¼ºç‚¹: æ— æ³•æ³›åŒ–]
    D --> D1[ä¼˜ç‚¹: å¯æ³›åŒ–<br/>ç¼ºç‚¹: éœ€è¦è®­ç»ƒ]
    
    style Compare fill:#e1bee7
    style Q fill:#ffccbc
    style D fill:#c8e6c9
    style Q1 fill:#fff3e0
    style D1 fill:#e8f5e9
```

## 10.4.2 DQNä¸‰å¤§æ³•å®

DQNæˆåŠŸçš„ç§˜è¯€åœ¨äºä¸‰ä¸ªå…³é”®æŠ€æœ¯åˆ›æ–°:

```mermaid
graph TB
    DQN[DQNæ ¸å¿ƒæŠ€æœ¯]
    
    DQN --> T1[æ³•å®1: ç¥ç»ç½‘ç»œ<br/>ç”¨CNNå¤„ç†å›¾åƒ]
    DQN --> T2[æ³•å®2: ç»éªŒå›æ”¾<br/>æ‰“ç ´æ•°æ®ç›¸å…³æ€§]
    DQN --> T3[æ³•å®3: ç›®æ ‡ç½‘ç»œ<br/>ç¨³å®šè®­ç»ƒè¿‡ç¨‹]
    
    T1 --> E1[è§£å†³: é«˜ç»´çŠ¶æ€]
    T2 --> E2[è§£å†³: æ ·æœ¬æ•ˆç‡]
    T3 --> E3[è§£å†³: è®­ç»ƒä¸ç¨³å®š]
    
    style DQN fill:#e1bee7
    style T1 fill:#bbdefb
    style T2 fill:#c5e1a5
    style T3 fill:#ffe0b2
    style E1 fill:#e3f2fd
    style E2 fill:#f1f8e9
    style E3 fill:#fff3e0
```

## 10.4.3 æ³•å®1: ç¥ç»ç½‘ç»œæ¶æ„

### ä¸ºä»€ä¹ˆç”¨å·ç§¯ç¥ç»ç½‘ç»œ(CNN)?

ç©Atariæ¸¸æˆ,è¾“å…¥æ˜¯æ¸¸æˆç”»é¢(å›¾åƒ),CNNæœ€æ“…é•¿å¤„ç†å›¾åƒ!

```mermaid
graph LR
    Input[æ¸¸æˆç”»é¢<br/>210Ã—160åƒç´ ] --> Conv1[å·ç§¯å±‚1<br/>æå–è¾¹ç¼˜]
    Conv1 --> Conv2[å·ç§¯å±‚2<br/>è¯†åˆ«ç‰©ä½“]
    Conv2 --> Conv3[å·ç§¯å±‚3<br/>ç†è§£åœºæ™¯]
    Conv3 --> FC1[å…¨è¿æ¥å±‚<br/>å†³ç­–æ¨ç†]
    FC1 --> Output[Qå€¼<br/>æ¯ä¸ªåŠ¨ä½œçš„åˆ†æ•°]
    
    style Input fill:#e3f2fd
    style Conv1 fill:#f3e5f5
    style Conv2 fill:#e8f5e9
    style Conv3 fill:#fff3e0
    style FC1 fill:#ffe0b2
    style Output fill:#c8e6c9
```

### ç½‘ç»œç»“æ„ç¤ºæ„

**è¾“å…¥**: æ¸¸æˆå±å¹• â†’ **è¾“å‡º**: æ¯ä¸ªåŠ¨ä½œçš„Qå€¼

```
è¾“å…¥å±‚: [84Ã—84Ã—4] å›¾åƒ  (4å¸§å åŠ ,æ„ŸçŸ¥è¿åŠ¨)
   â†“
å·ç§¯å±‚1: 32ä¸ª8Ã—8æ»¤æ³¢å™¨ â†’ [20Ã—20Ã—32]
   â†“  
å·ç§¯å±‚2: 64ä¸ª4Ã—4æ»¤æ³¢å™¨ â†’ [9Ã—9Ã—64]
   â†“
å·ç§¯å±‚3: 64ä¸ª3Ã—3æ»¤æ³¢å™¨ â†’ [7Ã—7Ã—64]
   â†“
å…¨è¿æ¥å±‚: 512ä¸ªç¥ç»å…ƒ
   â†“
è¾“å‡ºå±‚: åŠ¨ä½œæ•°é‡ä¸ªç¥ç»å…ƒ (å¦‚Atariæ¸¸æˆæœ‰18ä¸ªåŠ¨ä½œ)
```

### ç®€åŒ–ä»£ç å®ç°

```java
/**
 * DQNç¥ç»ç½‘ç»œ(ç®€åŒ–ç‰ˆ)
 */
public class DQNNetwork {
    private NeuralNetwork network;
    
    /**
     * æ„å»ºç½‘ç»œæ¶æ„
     */
    public DQNNetwork(int stateSize, int actionSize) {
        network = new NeuralNetwork();
        
        // è¾“å…¥å±‚
        network.addLayer(new InputLayer(stateSize));
        
        // éšè—å±‚
        network.addLayer(new DenseLayer(64, "relu"));
        network.addLayer(new DenseLayer(64, "relu"));
        
        // è¾“å‡ºå±‚(æ¯ä¸ªåŠ¨ä½œä¸€ä¸ªQå€¼)
        network.addLayer(new DenseLayer(actionSize, "linear"));
    }
    
    /**
     * å‰å‘ä¼ æ’­: çŠ¶æ€ â†’ Qå€¼
     */
    public double[] predict(double[] state) {
        return network.forward(state);
    }
    
    /**
     * è·å–æœ€ä¼˜åŠ¨ä½œ
     */
    public int getBestAction(double[] state) {
        double[] qValues = predict(state);
        return argmax(qValues);
    }
}
```

## 10.4.4 æ³•å®2: ç»éªŒå›æ”¾(Experience Replay)

### ä¸ºä»€ä¹ˆéœ€è¦ç»éªŒå›æ”¾?

**é—®é¢˜**: ç›´æ¥ç”¨å½“å‰ç»éªŒè®­ç»ƒä¼šæœ‰ä¸¤ä¸ªè‡´å‘½ç¼ºé™·:

1. **æ•°æ®ç›¸å…³æ€§å¼º**: è¿ç»­çš„æ¸¸æˆå¸§éå¸¸ç›¸ä¼¼
2. **æ ·æœ¬åˆ©ç”¨ç‡ä½**: æ¯ä¸ªç»éªŒåªç”¨ä¸€æ¬¡å°±æ‰”äº†

### ç”Ÿæ´»ç±»æ¯”: å­¦ä¹ æ–¹æ³•å¯¹æ¯”

```mermaid
graph TB
    subgraph ä¼ ç»Ÿåœ¨çº¿å­¦ä¹ 
        O1[è¾¹ç©è¾¹å­¦] --> O2[ç©ç¬¬1å…³â†’ç«‹å³å­¦ä¹ ]
        O2 --> O3[ç©ç¬¬2å…³â†’ç«‹å³å­¦ä¹ ]
        O3 --> O4[é—®é¢˜: åªè®°å¾—æœ€è¿‘çš„]
    end
    
    subgraph ç»éªŒå›æ”¾
        R1[å…ˆç©å†å­¦] --> R2[ç©å¾ˆå¤šå…³â†’å­˜å‚¨ç»éªŒ]
        R2 --> R3[éšæœºæŠ½å–ç»éªŒå­¦ä¹ ]
        R3 --> R4[ä¼˜åŠ¿: å…¨é¢å¤ä¹ ]
    end
    
    style O4 fill:#ffccbc
    style R4 fill:#c8e6c9
```

**å½¢è±¡æ¯”å–»**:
- **åœ¨çº¿å­¦ä¹ **: åƒè¾¹çœ‹ç”µå½±è¾¹åšç¬”è®°,åªè®°å¾—æœ€åçš„æƒ…èŠ‚
- **ç»éªŒå›æ”¾**: åƒå½•ä¸‹ç”µå½±,åå¤è§‚çœ‹å­¦ä¹ ,æ¯æ¬¡éšæœºé€‰ç‰‡æ®µ

### ç»éªŒå›æ”¾æœºåˆ¶

```mermaid
graph LR
    Play[ç©æ¸¸æˆ] --> Store[å­˜å…¥ç»éªŒæ± <br/>Replay Buffer]
    Store --> Sample[éšæœºé‡‡æ ·<br/>ä¸€æ‰¹ç»éªŒ]
    Sample --> Train[è®­ç»ƒç½‘ç»œ]
    Train --> Update[æ›´æ–°Qç½‘ç»œ]
    
    Store -.å®¹é‡æ»¡æ—¶.-> Delete[åˆ é™¤æœ€æ—§ç»éªŒ]
    
    style Play fill:#e3f2fd
    style Store fill:#f3e5f5
    style Sample fill:#e8f5e9
    style Train fill:#fff3e0
    style Update fill:#c8e6c9
```

### ç»éªŒæ± æ•°æ®ç»“æ„

æ¯æ¡ç»éªŒåŒ…å«5å…ƒç»„: **(s, a, r, s', done)**
- s: å½“å‰çŠ¶æ€
- a: æ‰§è¡Œçš„åŠ¨ä½œ
- r: è·å¾—çš„å¥–åŠ±
- s': ä¸‹ä¸€çŠ¶æ€
- done: æ˜¯å¦ç»“æŸ

### ä»£ç å®ç°

```java
/**
 * ç»éªŒå›æ”¾ç¼“å†²åŒº
 */
public class ReplayBuffer {
    private List<Experience> buffer;
    private int capacity;
    
    public ReplayBuffer(int capacity) {
        this.capacity = capacity;
        this.buffer = new ArrayList<>();
    }
    
    /**
     * å­˜å‚¨ç»éªŒ
     */
    public void store(double[] state, int action, double reward, 
                     double[] nextState, boolean done) {
        Experience exp = new Experience(state, action, reward, nextState, done);
        
        // å¦‚æœæ»¡äº†,åˆ é™¤æœ€æ—§çš„
        if (buffer.size() >= capacity) {
            buffer.remove(0);
        }
        
        buffer.add(exp);
    }
    
    /**
     * éšæœºé‡‡æ ·ä¸€æ‰¹ç»éªŒ
     */
    public List<Experience> sample(int batchSize) {
        List<Experience> batch = new ArrayList<>();
        Random rand = new Random();
        
        for (int i = 0; i < batchSize; i++) {
            int idx = rand.nextInt(buffer.size());
            batch.add(buffer.get(idx));
        }
        
        return batch;
    }
}

/**
 * ç»éªŒæ•°æ®ç»“æ„
 */
class Experience {
    double[] state;
    int action;
    double reward;
    double[] nextState;
    boolean done;
    
    // æ„é€ å‡½æ•°å’Œgetteræ–¹æ³•...
}
```

### ç»éªŒå›æ”¾çš„ä¼˜åŠ¿

âœ… **æ‰“ç ´ç›¸å…³æ€§**: éšæœºé‡‡æ ·è®©æ•°æ®æ›´ç‹¬ç«‹  
âœ… **æé«˜æ ·æœ¬æ•ˆç‡**: æ¯ä¸ªç»éªŒå¯ä»¥é‡å¤ä½¿ç”¨  
âœ… **ç¨³å®šè®­ç»ƒ**: å‡å°‘æ–¹å·®,è®­ç»ƒæ›´å¹³æ»‘  
âœ… **ç¦»çº¿å­¦ä¹ **: å¯ä»¥ä»åˆ«äººçš„ç»éªŒä¸­å­¦ä¹ 

## 10.4.5 æ³•å®3: ç›®æ ‡ç½‘ç»œ(Target Network)

### ä¸ºä»€ä¹ˆéœ€è¦ç›®æ ‡ç½‘ç»œ?

**é—®é¢˜**: ç”¨åŒä¸€ä¸ªç½‘ç»œè®¡ç®—å½“å‰Qå€¼å’Œç›®æ ‡Qå€¼,ä¼šå¯¼è‡´"è¿½é€ç§»åŠ¨ç›®æ ‡"

### ç”Ÿæ´»ç±»æ¯”: è€ƒè¯•ç›®æ ‡çš„ç¨³å®šæ€§

```mermaid
graph TB
    subgraph ä¸ç¨³å®šçš„ç›®æ ‡
        U1[ä»Šå¤©çš„ç›®æ ‡: è€ƒ80åˆ†] --> U2[å­¦ä¹ ä¸€å¤©å]
        U2 --> U3[æ˜å¤©çš„ç›®æ ‡å˜æˆ: è€ƒ90åˆ†]
        U3 --> U4[åˆå­¦ä¸€å¤©å]
        U4 --> U5[ç›®æ ‡åˆå˜æˆ: è€ƒ85åˆ†]
        U5 --> U6[ç»“æœ: è¿·å¤±æ–¹å‘]
    end
    
    subgraph ç¨³å®šçš„ç›®æ ‡
        S1[è®¾å®šç›®æ ‡: è€ƒ85åˆ†] --> S2[åšæŒå­¦ä¹ ]
        S2 --> S3[é˜¶æ®µæ€§æ£€æŸ¥]
        S3 --> S4[è¾¾åˆ°ç›®æ ‡å]
        S4 --> S5[æ›´æ–°ç›®æ ‡: è€ƒ90åˆ†]
    end
    
    style U6 fill:#ffccbc
    style S5 fill:#c8e6c9
```

### ç›®æ ‡ç½‘ç»œæœºåˆ¶

ç»´æŠ¤**ä¸¤ä¸ªç½‘ç»œ**:
- **ä¸»ç½‘ç»œ**(Q-Network): ç»å¸¸æ›´æ–°,ç”¨äºé€‰æ‹©åŠ¨ä½œ
- **ç›®æ ‡ç½‘ç»œ**(Target Network): å»¶è¿Ÿæ›´æ–°,ç”¨äºè®¡ç®—ç›®æ ‡Qå€¼

```mermaid
graph TB
    Main[ä¸»ç½‘ç»œ Î¸<br/>æ¯æ­¥æ›´æ–°] --> Action[é€‰æ‹©åŠ¨ä½œ]
    Target[ç›®æ ‡ç½‘ç»œ Î¸â»<br/>æ¯Næ­¥æ›´æ–°] --> TQ[è®¡ç®—ç›®æ ‡Qå€¼]
    
    Action --> Env[ç¯å¢ƒäº¤äº’]
    Env --> Exp[è·å¾—ç»éªŒ]
    Exp --> TQ
    TQ --> Loss[è®¡ç®—æŸå¤±]
    Loss --> Update[æ›´æ–°ä¸»ç½‘ç»œ]
    
    Update -.æ¯Cæ­¥.-> Sync[åŒæ­¥: Î¸â» â† Î¸]
    Sync --> Target
    
    style Main fill:#bbdefb
    style Target fill:#c5e1a5
    style Sync fill:#ffe0b2
```

### æ›´æ–°å…¬å¼å¯¹æ¯”

**ä¸ç”¨ç›®æ ‡ç½‘ç»œ**:
```
ç›®æ ‡ = r + Î³ max Q(s', a'; Î¸)
         â””â”€ ç”¨åŒä¸€ä¸ªç½‘ç»œÎ¸,ç›®æ ‡ä¼šä¸€ç›´å˜
```

**ä½¿ç”¨ç›®æ ‡ç½‘ç»œ**:
```
ç›®æ ‡ = r + Î³ max Q(s', a'; Î¸â»)
         â””â”€ ç”¨å›ºå®šçš„Î¸â»,ç›®æ ‡æ›´ç¨³å®š
```

### ä»£ç å®ç°

```java
/**
 * DQN withç›®æ ‡ç½‘ç»œ
 */
public class DQN {
    private DQNNetwork mainNetwork;    // ä¸»ç½‘ç»œ
    private DQNNetwork targetNetwork;  // ç›®æ ‡ç½‘ç»œ
    private int updateCounter = 0;
    private int targetUpdateFreq = 100; // æ¯100æ­¥åŒæ­¥ä¸€æ¬¡
    
    /**
     * è®­ç»ƒç½‘ç»œ
     */
    public void train(List<Experience> batch) {
        for (Experience exp : batch) {
            // 1. ç”¨ä¸»ç½‘ç»œé¢„æµ‹å½“å‰Qå€¼
            double[] currentQ = mainNetwork.predict(exp.state);
            
            // 2. ç”¨ç›®æ ‡ç½‘ç»œè®¡ç®—ç›®æ ‡Qå€¼
            double targetQ;
            if (exp.done) {
                targetQ = exp.reward;
            } else {
                double[] nextQ = targetNetwork.predict(exp.nextState);
                targetQ = exp.reward + gamma * max(nextQ);
            }
            
            // 3. æ›´æ–°Qå€¼
            currentQ[exp.action] = targetQ;
            
            // 4. è®­ç»ƒä¸»ç½‘ç»œ
            mainNetwork.fit(exp.state, currentQ);
        }
        
        // 5. å®šæœŸåŒæ­¥ç›®æ ‡ç½‘ç»œ
        updateCounter++;
        if (updateCounter % targetUpdateFreq == 0) {
            syncTargetNetwork();
        }
    }
    
    /**
     * åŒæ­¥ç›®æ ‡ç½‘ç»œ
     */
    private void syncTargetNetwork() {
        targetNetwork.copyWeightsFrom(mainNetwork);
        System.out.println("ç›®æ ‡ç½‘ç»œå·²åŒæ­¥");
    }
}
```

## 10.4.6 å®Œæ•´DQNç®—æ³•æµç¨‹

### ç®—æ³•å…¨æ™¯å›¾

```mermaid
graph TB
    Start[å¼€å§‹] --> Init[åˆå§‹åŒ–<br/>ä¸»ç½‘ç»œå’Œç›®æ ‡ç½‘ç»œ]
    Init --> InitBuffer[åˆå§‹åŒ–ç»éªŒæ± ]
    
    InitBuffer --> Episode[å¼€å§‹æ–°å›åˆ]
    Episode --> Reset[é‡ç½®ç¯å¢ƒ]
    Reset --> State[è§‚å¯ŸçŠ¶æ€s]
    
    State --> Epsilon[Îµ-è´ªå¿ƒé€‰æ‹©åŠ¨ä½œ]
    Epsilon --> Exec[æ‰§è¡ŒåŠ¨ä½œa]
    Exec --> Store[å­˜å‚¨ç»éªŒ<br/>åˆ°ç»éªŒæ± ]
    
    Store --> Check1{ç»éªŒæ± <br/>è¶³å¤Ÿ?}
    Check1 -->|å¦| NextState
    Check1 -->|æ˜¯| Sample[éšæœºé‡‡æ ·<br/>ä¸€æ‰¹ç»éªŒ]
    
    Sample --> ComputeTarget[ç”¨ç›®æ ‡ç½‘ç»œ<br/>è®¡ç®—ç›®æ ‡Qå€¼]
    ComputeTarget --> Train[è®­ç»ƒä¸»ç½‘ç»œ]
    Train --> UpdateTarget{è¾¾åˆ°<br/>æ›´æ–°é¢‘ç‡?}
    
    UpdateTarget -->|æ˜¯| Sync[åŒæ­¥ç›®æ ‡ç½‘ç»œ]
    UpdateTarget -->|å¦| NextState
    Sync --> NextState
    
    NextState[s â† s'] --> Terminal{ç»ˆæ­¢?}
    Terminal -->|å¦| State
    Terminal -->|æ˜¯| Decay[è¡°å‡Îµ]
    
    Decay --> CheckEpisode{å®Œæˆ<br/>è¶³å¤Ÿå›åˆ?}
    CheckEpisode -->|å¦| Episode
    CheckEpisode -->|æ˜¯| End[ç»“æŸ]
    
    style Start fill:#e8f5e9
    style Init fill:#e3f2fd
    style Sample fill:#f3e5f5
    style Train fill:#fff3e0
    style Sync fill:#ffe0b2
    style End fill:#c8e6c9
```

### ä¼ªä»£ç 

```
ç®—æ³•: DQN

åˆå§‹åŒ–:
  - åˆå§‹åŒ–ä¸»ç½‘ç»œQ(s,a;Î¸)
  - åˆå§‹åŒ–ç›®æ ‡ç½‘ç»œQ(s,a;Î¸â») = Q(s,a;Î¸)
  - åˆå§‹åŒ–ç»éªŒæ± D,å®¹é‡N
  - è®¾ç½®å‚æ•°: Î±(å­¦ä¹ ç‡), Î³(æŠ˜æ‰£), Îµ(æ¢ç´¢ç‡), C(ç›®æ ‡ç½‘ç»œæ›´æ–°é¢‘ç‡)

é‡å¤ (æ¯ä¸ªå›åˆ):
  åˆå§‹åŒ–çŠ¶æ€ s
  
  é‡å¤ (æ¯ä¸ªæ—¶é—´æ­¥):
    // 1. é€‰æ‹©åŠ¨ä½œ
    ç”¨Îµ-è´ªå¿ƒä»Q(s,a;Î¸)é€‰æ‹©åŠ¨ä½œa
    
    // 2. æ‰§è¡ŒåŠ¨ä½œ
    æ‰§è¡Œa, è§‚å¯Ÿrå’Œs'
    
    // 3. å­˜å‚¨ç»éªŒ
    å°†(s,a,r,s',done)å­˜å…¥D
    
    // 4. è®­ç»ƒç½‘ç»œ
    if |D| >= batch_size:
      ä»Déšæœºé‡‡æ ·batch
      
      for æ¯æ¡ç»éªŒ(s,a,r,s',done):
        if done:
          y = r
        else:
          y = r + Î³ max_a' Q(s',a';Î¸â»)  // ç”¨ç›®æ ‡ç½‘ç»œ
        
        ç”¨æ¢¯åº¦ä¸‹é™æœ€å°åŒ– (y - Q(s,a;Î¸))Â²
    
    // 5. æ›´æ–°ç›®æ ‡ç½‘ç»œ
    æ¯Cæ­¥: Î¸â» â† Î¸
    
    s â† s'
  
  ç›´åˆ°å›åˆç»“æŸ
  
  è¡°å‡Îµ
  
ç›´åˆ°æ”¶æ•›
```

## 10.4.7 DQNè®­ç»ƒæŠ€å·§

### è¶…å‚æ•°é…ç½®å»ºè®®

```mermaid
graph TB
    Params[DQNè¶…å‚æ•°]
    
    Params --> Network[ç½‘ç»œå‚æ•°]
    Params --> Training[è®­ç»ƒå‚æ•°]
    Params --> Exploration[æ¢ç´¢å‚æ•°]
    
    Network --> N1[å­¦ä¹ ç‡: 0.00025]
    Network --> N2[ç½‘ç»œç»“æ„: è§ä¸Šæ–‡]
    
    Training --> T1[ç»éªŒæ± å¤§å°: 100ä¸‡]
    Training --> T2[æ‰¹æ¬¡å¤§å°: 32]
    Training --> T3[ç›®æ ‡ç½‘ç»œæ›´æ–°: æ¯1ä¸‡æ­¥]
    Training --> T4[æŠ˜æ‰£å› å­: 0.99]
    
    Exploration --> E1[åˆå§‹Îµ: 1.0]
    Exploration --> E2[æœ€ç»ˆÎµ: 0.1]
    Exploration --> E3[è¡°å‡æ­¥æ•°: 100ä¸‡æ­¥]
    
    style Params fill:#e1bee7
    style Network fill:#bbdefb
    style Training fill:#c5e1a5
    style Exploration fill:#ffe0b2
```

### è®­ç»ƒç¨³å®šæ€§æŠ€å·§

| æŠ€å·§ | ä½œç”¨ | æ¨èå€¼ |
|------|------|--------|
| æ¢¯åº¦è£å‰ª | é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ | [-1, 1] |
| Rewardè£å‰ª | å½’ä¸€åŒ–å¥–åŠ± | [-1, 1] |
| å¸§å åŠ  | æ„ŸçŸ¥è¿åŠ¨ä¿¡æ¯ | 4å¸§ |
| è·³å¸§ | æé«˜æ•ˆç‡ | æ¯4å¸§1æ¬¡ |
| é¢„è®­ç»ƒ | åŠ é€Ÿæ”¶æ•› | 5ä¸‡æ­¥ |

### æ€§èƒ½ç›‘æ§æŒ‡æ ‡

```mermaid
graph LR
    Monitor[ç›‘æ§æŒ‡æ ‡]
    
    Monitor --> M1[å¹³å‡å¥–åŠ±<br/>æ¯å›åˆå¾—åˆ†]
    Monitor --> M2[Qå€¼å˜åŒ–<br/>ç½‘ç»œå­¦ä¹ æƒ…å†µ]
    Monitor --> M3[æŸå¤±æ›²çº¿<br/>è®­ç»ƒç¨³å®šæ€§]
    Monitor --> M4[æ¢ç´¢ç‡Îµ<br/>æ¢ç´¢åˆ©ç”¨å¹³è¡¡]
    
    style Monitor fill:#e1bee7
    style M1 fill:#c8e6c9
    style M2 fill:#bbdefb
    style M3 fill:#ffe0b2
    style M4 fill:#f3e5f5
```

## 10.4.8 DQNæˆåŠŸæ¡ˆä¾‹: Atariæ¸¸æˆ

### çªç ´æ€§æˆæœ

2015å¹´,DeepMindçš„DQNåœ¨49æ¬¾Atariæ¸¸æˆä¸­:
- 29æ¬¾æ¸¸æˆè¶…è¶Šäººç±»æ°´å¹³
- Breakout(æ‰“ç –å—)æ¸¸æˆå¾—åˆ†æ˜¯äººç±»çš„10å€!

```mermaid
graph TB
    Games[Atariæ¸¸æˆè¡¨ç°]
    
    Games --> G1[Breakoutæ‰“ç –å—<br/>DQN: 400åˆ†<br/>äººç±»: 30åˆ†]
    Games --> G2[Space Invaders<br/>DQN: 1500åˆ†<br/>äººç±»: 1200åˆ†]
    Games --> G3[Pongä¹’ä¹“<br/>DQN: 21åˆ†<br/>äººç±»: 20åˆ†]
    
    style Games fill:#e1bee7
    style G1 fill:#81c784
    style G2 fill:#81c784
    style G3 fill:#81c784
```

### å­¦ä¹ è¿‡ç¨‹å¯è§†åŒ–

ä»¥Breakoutæ¸¸æˆä¸ºä¾‹:

```mermaid
graph LR
    S1[åˆæœŸ<br/>éšæœºä¹±æ‰“] --> S2[å­¦ä¼šæ¥çƒ<br/>ä¸è®©çƒè½åœ°]
    S2 --> S3[å‘ç°ç­–ç•¥<br/>æ‰“ç©¿ç –å—ä¾§é¢]
    S3 --> S4[å¤§å¸ˆçº§<br/>è®©çƒåœ¨é¡¶éƒ¨åå¼¹]
    
    S1 -.å¾—åˆ†: 5.-> S1
    S2 -.å¾—åˆ†: 50.-> S2
    S3 -.å¾—åˆ†: 200.-> S3
    S4 -.å¾—åˆ†: 400+.-> S4
    
    style S1 fill:#ffccbc
    style S2 fill:#ffe0b2
    style S3 fill:#fff9c4
    style S4 fill:#c8e6c9
```

## 10.4.9 DQNä¼˜åŠ¿ä¸å±€é™

### ä¼˜åŠ¿ âœ…

```mermaid
graph TB
    Adv[DQNä¼˜åŠ¿]
    
    Adv --> A1[å¤„ç†é«˜ç»´è¾“å…¥<br/>å›¾åƒã€è¿ç»­çŠ¶æ€]
    Adv --> A2[ç«¯åˆ°ç«¯å­¦ä¹ <br/>ä»åƒç´ åˆ°åŠ¨ä½œ]
    Adv --> A3[æ— éœ€ç‰¹å¾å·¥ç¨‹<br/>è‡ªåŠ¨å­¦ä¹ è¡¨ç¤º]
    Adv --> A4[æ ·æœ¬æ•ˆç‡é«˜<br/>ç»éªŒå›æ”¾å¤ç”¨]
    
    style Adv fill:#c8e6c9
    style A1 fill:#81c784
    style A2 fill:#66bb6a
    style A3 fill:#4caf50
    style A4 fill:#43a047
```

### å±€é™ âš ï¸

```mermaid
graph TB
    Lim[DQNå±€é™]
    
    Lim --> L1[ç¦»æ•£åŠ¨ä½œç©ºé—´<br/>ä¸é€‚åˆè¿ç»­æ§åˆ¶]
    Lim --> L2[Qå€¼è¿‡ä¼°è®¡<br/>å¯èƒ½å¯¼è‡´æ¬¡ä¼˜ç­–ç•¥]
    Lim --> L3[è®­ç»ƒæ—¶é—´é•¿<br/>éœ€è¦å¤§é‡æ ·æœ¬]
    Lim --> L4[è¶…å‚æ•°æ•æ„Ÿ<br/>è°ƒå‚å›°éš¾]
    
    style Lim fill:#ffccbc
    style L1 fill:#ff8a65
    style L2 fill:#ff7043
    style L3 fill:#ff5722
    style L4 fill:#f4511e
```

### æ”¹è¿›æ–¹å‘

ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å­¦ä¹ DQNçš„æ”¹è¿›ç‰ˆæœ¬:
- **Double DQN**: è§£å†³Qå€¼è¿‡ä¼°è®¡
- **Dueling DQN**: åˆ†ç¦»çŠ¶æ€ä»·å€¼å’Œä¼˜åŠ¿å‡½æ•°
- **Prioritized Replay**: ä¼˜å…ˆå›æ”¾é‡è¦ç»éªŒ

## æœ¬èŠ‚å°ç»“

### çŸ¥è¯†ç»“æ„å›¾

```mermaid
graph TB
    DQN[æ·±åº¦Qç½‘ç»œDQN]
    
    DQN --> Core[æ ¸å¿ƒåˆ›æ–°<br/>ç¥ç»ç½‘ç»œè¿‘ä¼¼Qå‡½æ•°]
    DQN --> Tech1[æŠ€æœ¯1<br/>ç»éªŒå›æ”¾]
    DQN --> Tech2[æŠ€æœ¯2<br/>ç›®æ ‡ç½‘ç»œ]
    DQN --> Apply[åº”ç”¨<br/>Atariæ¸¸æˆ]
    
    Core --> C1[çªç ´Qè¡¨é™åˆ¶]
    Core --> C2[å¤„ç†é«˜ç»´çŠ¶æ€]
    
    Tech1 --> T11[æ‰“ç ´æ•°æ®ç›¸å…³]
    Tech1 --> T12[æé«˜æ ·æœ¬æ•ˆç‡]
    
    Tech2 --> T21[ç¨³å®šè®­ç»ƒ]
    Tech2 --> T22[å›ºå®šç›®æ ‡]
    
    Apply --> A1[è¶…è¶Šäººç±»æ°´å¹³]
    Apply --> A2[ç«¯åˆ°ç«¯å­¦ä¹ ]
    
    style DQN fill:#e1bee7
    style Core fill:#bbdefb
    style Tech1 fill:#c5e1a5
    style Tech2 fill:#ffe0b2
    style Apply fill:#f8bbd0
```

### æ ¸å¿ƒè¦ç‚¹

1. **ç¥ç»ç½‘ç»œ**: ç”¨æ·±åº¦å­¦ä¹ è¿‘ä¼¼Qå‡½æ•°,çªç ´ç»´åº¦é™åˆ¶
2. **ç»éªŒå›æ”¾**: éšæœºé‡‡æ ·å†å²ç»éªŒ,æ‰“ç ´æ•°æ®ç›¸å…³æ€§
3. **ç›®æ ‡ç½‘ç»œ**: å»¶è¿Ÿæ›´æ–°ç›®æ ‡,ç¨³å®šè®­ç»ƒè¿‡ç¨‹
4. **åº”ç”¨ä»·å€¼**: åœ¨Atariæ¸¸æˆä¸­è¾¾åˆ°æˆ–è¶…è¶Šäººç±»æ°´å¹³
5. **é‡Œç¨‹ç¢‘æ„ä¹‰**: å¼€å¯æ·±åº¦å¼ºåŒ–å­¦ä¹ æ—¶ä»£

### DQN vs Q-Learningå¯¹æ¯”

| ç‰¹æ€§ | Q-Learning | DQN |
|------|-----------|-----|
| çŠ¶æ€è¡¨ç¤º | Qè¡¨ | ç¥ç»ç½‘ç»œ |
| é€‚ç”¨åœºæ™¯ | ä½ç»´ç¦»æ•£çŠ¶æ€ | é«˜ç»´è¿ç»­çŠ¶æ€ |
| æ³›åŒ–èƒ½åŠ› | å¼± | å¼º |
| æ ·æœ¬æ•ˆç‡ | ä¸€èˆ¬ | é«˜(ç»éªŒå›æ”¾) |
| è®­ç»ƒç¨³å®šæ€§ | å¥½ | éœ€è¦æŠ€å·§ |
| å®ç°å¤æ‚åº¦ | ç®€å• | è¾ƒå¤æ‚ |

### å®è·µå»ºè®®

ğŸ’¡ **ä»ç®€å•ç¯å¢ƒå¼€å§‹**: å¦‚CartPole,å…ˆéªŒè¯DQNèƒ½è·‘é€š  
ğŸ’¡ **ç›‘æ§å­¦ä¹ æ›²çº¿**: è§‚å¯Ÿå¥–åŠ±ã€Qå€¼ã€æŸå¤±çš„å˜åŒ–è¶‹åŠ¿  
ğŸ’¡ **è°ƒè¯•ç»éªŒæ± **: ç¡®ä¿å­˜å‚¨å’Œé‡‡æ ·é€»è¾‘æ­£ç¡®  
ğŸ’¡ **è€å¿ƒç­‰å¾…**: DQNè®­ç»ƒå¯èƒ½éœ€è¦æ•°å°æ—¶ç”šè‡³æ•°å¤©

### ç”Ÿæ´»å¯ç¤º

DQNå‘Šè¯‰æˆ‘ä»¬:
- **å¤§è„‘èƒœè¿‡ç¬”è®°æœ¬**: ç†è§£åŸç†æ¯”æ­»è®°ç¡¬èƒŒé‡è¦
- **æ¸©æ•…çŸ¥æ–°**: åå¤å­¦ä¹ è¿‡å»çš„ç»éªŒ(ç»éªŒå›æ”¾)
- **ç¨³æ‰ç¨³æ‰“**: ä¸è¦é¢‘ç¹æ”¹å˜ç›®æ ‡(ç›®æ ‡ç½‘ç»œ)
- **å¾ªåºæ¸è¿›**: ä»æ¢ç´¢åˆ°åˆ©ç”¨çš„é€æ­¥è½¬å˜(Îµè¡°å‡)

ä¸‹ä¸€èŠ‚,æˆ‘ä»¬å°†å­¦ä¹ DQNçš„å„ç§æ”¹è¿›ç®—æ³•,çœ‹çœ‹ç ”ç©¶è€…ä»¬å¦‚ä½•è®©DQNå˜å¾—æ›´å¼º!

---

**ç»ƒä¹ ä»»åŠ¡**:
1. ç”¨ä¼ªä»£ç å®ç°ä¸€ä¸ªç®€åŒ–çš„DQNè®­ç»ƒå¾ªç¯
2. æ€è€ƒ: ä¸ºä»€ä¹ˆç»éªŒå›æ”¾èƒ½æé«˜æ ·æœ¬æ•ˆç‡?
3. å°è¯•è°ƒæ•´ç›®æ ‡ç½‘ç»œæ›´æ–°é¢‘ç‡,è§‚å¯Ÿå¯¹è®­ç»ƒçš„å½±å“
