# 18.6 ç»¼åˆé¡¹ç›®ï¼šæ™ºèƒ½ä½“åä½œå¼€å‘å¹³å°

> **è®¾è®¡æ€æƒ³**ï¼šå°†å‰é¢5èŠ‚å­¦åˆ°çš„çŸ¥è¯†èä¼šè´¯é€š,æ„å»ºä¸€ä¸ªå®Œæ•´çš„AIè¾…åŠ©å¼€å‘ç”Ÿæ€ã€‚è¿™ä¸ä»…æ˜¯æŠ€æœ¯çš„ç»¼åˆåº”ç”¨,æ›´æ˜¯å¯¹å¤šæ™ºèƒ½ä½“ç³»ç»Ÿè®¾è®¡ç†å¿µçš„æ·±åº¦å®è·µã€‚

## å¼•è¨€ï¼šä»å­¦ä¹ åˆ°å®æˆ˜

ç»è¿‡å‰é¢çš„å­¦ä¹ ,æˆ‘ä»¬æŒæ¡äº†ï¼š
- ğŸ’¡ å¤šç§åä½œæ¨¡å¼ï¼ˆé›†ä¸­å¼ã€åˆ†å¸ƒå¼ã€ä¸»ä»å¼...ï¼‰
- ğŸ¤– ä¸“ä¸šæ™ºèƒ½ä½“ï¼ˆä»£ç ã€æ–‡æ¡£ã€ç ”ç©¶...ï¼‰
- ğŸŒ ç”Ÿæ€ç³»ç»Ÿï¼ˆå¸‚åœºã€åè®®ã€ç›‘æ§...ï¼‰

ç°åœ¨,è®©æˆ‘ä»¬æŠŠè¿™äº›æ‹¼å›¾ç»„åˆèµ·æ¥,æ„å»ºä¸€ä¸ª**å®Œæ•´çš„æ™ºèƒ½ä½“åä½œå¼€å‘å¹³å°**ã€‚

```mermaid
graph LR
    A[ç¬¬18.1èŠ‚<br/>åä½œæ¨¡å¼] --> Final[ç»¼åˆ<br/>å¼€å‘å¹³å°]
    B[ç¬¬18.2èŠ‚<br/>ç¼–ç¨‹åŠ©æ‰‹] --> Final
    C[ç¬¬18.3èŠ‚<br/>æ–‡æ¡£åŠ©æ‰‹] --> Final
    D[ç¬¬18.4èŠ‚<br/>ç ”ç©¶åŠ©æ‰‹] --> Final
    E[ç¬¬18.5èŠ‚<br/>æ™ºèƒ½ä½“ç”Ÿæ€] --> Final
    
    style Final fill:#51cf66,color:#fff
```

## å­¦ä¹ ç›®æ ‡

- âœ… **ç»¼åˆåº”ç”¨**ï¼šæ•´åˆå¤šç§åä½œæ¨¡å¼å’Œä¸“ä¸šæ™ºèƒ½ä½“
- âœ… **ç³»ç»Ÿè®¾è®¡**ï¼šæŒæ¡å¤æ‚ç³»ç»Ÿçš„æ¶æ„è®¾è®¡æ–¹æ³•
- âœ… **å®æˆ˜èƒ½åŠ›**ï¼šèƒ½ç‹¬ç«‹æ„å»ºå®Œæ•´çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ
- âœ… **æ‰©å±•æ€ç»´**ï¼šç†è§£å¦‚ä½•æŒç»­æ¼”è¿›å’Œä¼˜åŒ–ç³»ç»Ÿ

---

## é¡¹ç›®éœ€æ±‚ï¼šDevAssistå¹³å°

### 1. ç›®æ ‡ç”¨æˆ·

**ç›®æ ‡**ï¼šæ„å»ºä¸€ä¸ªé¢å‘Javaå¼€å‘å›¢é˜Ÿçš„AIè¾…åŠ©å¼€å‘å¹³å°ã€‚

**ç”¨æˆ·ç”»åƒ**ï¼š
- ğŸ‘¨â€ğŸ’» **Javaå¼€å‘è€…**ï¼šéœ€è¦ä»£ç ç”Ÿæˆã€å®¡æŸ¥ã€ä¼˜åŒ–
- ğŸ“ **æŠ€æœ¯å†™ä½œè€…**ï¼šéœ€è¦æ–‡æ¡£è‡ªåŠ¨åŒ–ç”Ÿæˆ
- ğŸ”¬ **æŠ€æœ¯Leader**ï¼šéœ€è¦æŠ€æœ¯è°ƒç ”å’Œå†³ç­–æ”¯æŒ

### 2. æ ¸å¿ƒåŠŸèƒ½

```mermaid
mindmap
  root((DevAssist<br/>å¹³å°))
    ä»£ç å¼€å‘
      æ™ºèƒ½è¡¥å…¨
      ä»£ç ç”Ÿæˆ
      è‡ªåŠ¨é‡æ„
      Bugä¿®å¤
    æ–‡æ¡£ç®¡ç†
      APIæ–‡æ¡£ç”Ÿæˆ
      è®¾è®¡æ–‡æ¡£æ’°å†™
      Release Notes
    æŠ€æœ¯ç ”ç©¶
      æŠ€æœ¯é€‰å‹
      ç«å“åˆ†æ
      è¶‹åŠ¿é¢„æµ‹
    å›¢é˜Ÿåä½œ
      Code Review
      çŸ¥è¯†å…±äº«
      è¿›åº¦åŒæ­¥
```

---

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1. åˆ†å±‚æ¶æ„

é‡‡ç”¨ç»å…¸çš„å››å±‚æ¶æ„ï¼š

```mermaid
graph TB
    subgraph "æ¥å…¥å±‚ - Access Layer"
        Web[Webæ§åˆ¶å°]
        IDE[IDEæ’ä»¶]
        API[REST API]
        CLI[å‘½ä»¤è¡Œå·¥å…·]
    end
    
    subgraph "æœåŠ¡å±‚ - Service Layer"
        Orch[ä»»åŠ¡ç¼–æ’<br/>Orchestrator]
        Auth[è®¤è¯æˆæƒ<br/>Auth Service]
        Gateway[APIç½‘å…³<br/>Gateway]
    end
    
    subgraph "æ™ºèƒ½ä½“å±‚ - Agent Layer"
        Code[ä»£ç Agent]
        Doc[æ–‡æ¡£Agent]
        Research[ç ”ç©¶Agent]
        Review[å®¡æŸ¥Agent]
    end
    
    subgraph "åŸºç¡€å±‚ - Infrastructure"
        LLM[LLMæœåŠ¡]
        DB[(æ•°æ®åº“)]
        Cache[(ç¼“å­˜)]
        MQ[æ¶ˆæ¯é˜Ÿåˆ—]
    end
    
    Web --> Gateway
    IDE --> Gateway
    API --> Gateway
    CLI --> Gateway
    
    Gateway --> Orch
    Gateway --> Auth
    
    Orch --> Code
    Orch --> Doc
    Orch --> Research
    Orch --> Review
    
    Code --> LLM
    Doc --> LLM
    Research --> LLM
    
    Code --> DB
    Doc --> DB
    
    Code --> Cache
    
    Orch --> MQ
    
    style Orch fill:#ff6b6b,color:#fff
    style Code fill:#339af0
    style Doc fill:#51cf66
    style Research fill:#ffd43b
    style Review fill:#a855f7
```

### 2. æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | èŒè´£ | æŠ€æœ¯é€‰å‹ |
|------|------|---------|
| **ä»»åŠ¡ç¼–æ’å™¨** | åè°ƒæ™ºèƒ½ä½“åä½œ | Spring Boot + CompletableFuture |
| **ä»£ç Agent** | ä»£ç ç›¸å…³åŠŸèƒ½ | LangChain4j + GPT-4 |
| **æ–‡æ¡£Agent** | æ–‡æ¡£å¤„ç† | Markdown Parser + LLM |
| **ç ”ç©¶Agent** | æŠ€æœ¯è°ƒç ” | RAG + Semantic Search |
| **æ¶ˆæ¯é˜Ÿåˆ—** | å¼‚æ­¥é€šä¿¡ | RabbitMQ / Kafka |
| **æ•°æ®åº“** | æ•°æ®æŒä¹…åŒ– | PostgreSQL + Redis |

---

## æ ¸å¿ƒæµç¨‹å®ç°

### 1. å…¸å‹å·¥ä½œæµï¼šä»£ç Review

ä»ä¸€ä¸ªå®é™…åœºæ™¯å…¥æ‰‹ï¼šå¼€å‘è€…æäº¤ä»£ç ,ç³»ç»Ÿè‡ªåŠ¨Reviewã€‚

```mermaid
sequenceDiagram
    participant Dev as ğŸ‘¨â€ğŸ’» å¼€å‘è€…
    participant Web as Webç•Œé¢
    participant Orch as ç¼–æ’å™¨
    participant Code as ä»£ç Agent
    participant Review as å®¡æŸ¥Agent
    participant DB as æ•°æ®åº“
    
    Dev->>Web: æäº¤PR
    Web->>Orch: è§¦å‘Review
    
    Orch->>Code: è§£æä»£ç å˜æ›´
    Code->>Code: ASTåˆ†æ
    Code-->>Orch: ä»£ç ç»“æ„
    
    Orch->>Review: æ‰§è¡Œå®¡æŸ¥
    Review->>Review: å¤šç»´åº¦æ£€æŸ¥
    Review-->>Orch: å®¡æŸ¥æŠ¥å‘Š
    
    Orch->>DB: ä¿å­˜ç»“æœ
    Orch-->>Web: è¿”å›æŠ¥å‘Š
    Web-->>Dev: æ˜¾ç¤ºReviewç»“æœ
```

### 2. æ ¸å¿ƒJavaä»£ç 

```java
@Service
public class DevAssistOrchestrator {
    @Autowired
    private CodeAgent codeAgent;
    
    @Autowired
    private CodeReviewAgent reviewAgent;
    
    @Autowired
    private NotificationService notificationService;
    
    public ReviewResult handlePullRequest(PullRequest pr) {
        // 1. è§£æä»£ç å˜æ›´
        CodeChange change = codeAgent.parseChanges(pr.getDiff());
        
        // 2. å¹¶è¡Œæ‰§è¡Œå¤šé¡¹æ£€æŸ¥
        CompletableFuture<QualityReport> qualityCheck = 
            CompletableFuture.supplyAsync(() -> 
                reviewAgent.checkQuality(change));
        
        CompletableFuture<SecurityReport> securityCheck = 
            CompletableFuture.supplyAsync(() -> 
                reviewAgent.checkSecurity(change));
        
        CompletableFuture<PerformanceReport> perfCheck = 
            CompletableFuture.supplyAsync(() -> 
                reviewAgent.checkPerformance(change));
        
        // 3. ç­‰å¾…æ‰€æœ‰æ£€æŸ¥å®Œæˆ
        CompletableFuture.allOf(qualityCheck, securityCheck, perfCheck).join();
        
        // 4. æ±‡æ€»ç»“æœ
        ReviewResult result = new ReviewResult();
        result.setQualityReport(qualityCheck.join());
        result.setSecurityReport(securityCheck.join());
        result.setPerformanceReport(perfCheck.join());
        result.calculateOverallScore();
        
        // 5. é€šçŸ¥å¼€å‘è€…
        notificationService.notifyReviewComplete(pr.getAuthor(), result);
        
        return result;
    }
}
```

**è®¾è®¡äº®ç‚¹**ï¼š
- âœ… å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œæå‡æ•ˆç‡
- âœ… ç»“æœæ±‡æ€»ç»Ÿä¸€å±•ç¤º
- âœ… è‡ªåŠ¨é€šçŸ¥æ— éœ€ç­‰å¾…

---

## å…³é”®æŠ€æœ¯å®ç°

### 1. æ™ºèƒ½ä½“æ³¨å†Œä¸å‘ç°

```java
@Component
public class AgentRegistry {
    private final Map<String, AgentDescriptor> agents = new ConcurrentHashMap<>();
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    // æ³¨å†Œæ™ºèƒ½ä½“
    public void register(AgentDescriptor descriptor) {
        validateDescriptor(descriptor);
        agents.put(descriptor.getId(), descriptor);
        eventPublisher.publishEvent(new AgentRegisteredEvent(descriptor));
        log.info("Agent registered: {}", descriptor.getId());
    }
    
    // å‘ç°æ™ºèƒ½ä½“ï¼ˆæŒ‰èƒ½åŠ›ï¼‰
    public List<AgentDescriptor> discover(String capability) {
        return agents.values().stream()
                    .filter(agent -> agent.hasCapability(capability))
                    .filter(AgentDescriptor::isHealthy)
                    .sorted(Comparator.comparing(AgentDescriptor::getRating)
                                     .reversed())
                    .collect(Collectors.toList());
    }
    
    // å¥åº·æ£€æŸ¥
    @Scheduled(fixedRate = 30000)
    public void healthCheck() {
        agents.values().forEach(agent -> {
            if (!checkHealth(agent)) {
                agent.setHealthy(false);
                eventPublisher.publishEvent(new AgentUnhealthyEvent(agent));
            }
        });
    }
}
```

### 2. ä»»åŠ¡ç¼–æ’å¼•æ“

æ”¯æŒYAMLå·¥ä½œæµå®šä¹‰ï¼š

```yaml
# code-review-workflow.yaml
workflow:
  name: code-review
  
  steps:
    - id: parse
      agent: code-understanding
      action: parse_diff
      input: ${pr.diff}
      output: code_change
      
    - id: quality
      agent: code-reviewer
      action: check_quality
      input: ${code_change}
      output: quality_report
      
    - id: security
      agent: security-scanner
      action: scan_vulnerabilities  
      input: ${code_change}
      output: security_report
      parallel_with: [quality]  # å¹¶è¡Œæ‰§è¡Œ
      
    - id: suggest
      agent: code-optimizer
      action: generate_suggestions
      input:
        change: ${code_change}
        issues: ${quality_report.issues}
      output: suggestions
      condition: ${quality_report.score} < 80  # æ¡ä»¶æ‰§è¡Œ
```

å¯¹åº”çš„Javaæ‰§è¡Œå¼•æ“ï¼š

```java
@Service
public class WorkflowEngine {
    @Autowired
    private AgentRegistry agentRegistry;
    
    public WorkflowResult execute(Workflow workflow, 
                                  Map<String, Object> initialContext) {
        WorkflowContext context = new WorkflowContext(initialContext);
        
        for (WorkflowStep step : workflow.getSteps()) {
            // æ£€æŸ¥æ‰§è¡Œæ¡ä»¶
            if (!evaluateCondition(step.getCondition(), context)) {
                continue;
            }
            
            // å‡†å¤‡è¾“å…¥å¹¶æ‰§è¡Œ
            Map<String, Object> input = resolveInput(step.getInput(), context);
            Agent agent = agentRegistry.findById(step.getAgentId());
            
            Object result = agent.execute(step.getAction(), input);
            context.put(step.getOutput(), result);
        }
        
        return new WorkflowResult(context);
    }
}
```

### 3. ç›‘æ§ä¸å¯è§‚æµ‹æ€§

```java
@Component
public class MonitoringService {
    @Autowired
    private MeterRegistry meterRegistry;
    
    // è®°å½•æŒ‡æ ‡
    public void recordAgentExecution(String agentId, 
                                     long duration, 
                                     boolean success) {
        meterRegistry.counter("agent.executions", 
            "agent", agentId,
            "success", String.valueOf(success)
        ).increment();
        
        meterRegistry.timer("agent.execution.time", "agent", agentId)
                    .record(Duration.ofMillis(duration));
    }
    
    // è·å–ä»ªè¡¨ç›˜æ•°æ®
    public DashboardData getDashboardData() {
        return DashboardData.builder()
            .totalAgents(agentRegistry.count())
            .activeAgents(agentRegistry.countHealthy())
            .totalExecutions(getTotalExecutions())
            .avgResponseTime(getAvgResponseTime())
            .successRate(getSuccessRate())
            .build();
    }
}
```

---

## å®æˆ˜æ¼”ç»ƒï¼šå®Œæ•´æ¡ˆä¾‹

### åœºæ™¯ï¼šå®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½

#### 1. ç”¨æˆ·æäº¤éœ€æ±‚

```java
TaskRequest request = TaskRequest.builder()
    .type("feature_development")
    .title("å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½")
    .description("éœ€è¦å®ç°ç”¨æˆ·åå¯†ç ç™»å½•,åŒ…æ‹¬Tokenç”Ÿæˆå’ŒéªŒè¯")
    .requirements(List.of(
        "ä½¿ç”¨Spring Security",
        "JWT Tokenè®¤è¯",
        "æ”¯æŒè®°ä½æˆ‘åŠŸèƒ½"
    ))
    .build();
```

#### 2. ç³»ç»Ÿæ‰§è¡Œæµç¨‹

```mermaid
graph TB
    Start[å¼€å§‹] --> Analyze[éœ€æ±‚åˆ†æ]
    Analyze --> Design[è®¾è®¡æ–¹æ¡ˆ]
    Design --> Code[ç”Ÿæˆä»£ç ]
    Code --> Review[ä»£ç å®¡æŸ¥]
    Review --> Test[ç”Ÿæˆæµ‹è¯•]
    Test --> Doc[ç”Ÿæˆæ–‡æ¡£]
    Doc --> Done[å®Œæˆ]
    
    Review -->|æœ‰é—®é¢˜| Optimize[ä¼˜åŒ–ä»£ç ]
    Optimize --> Review
    
    style Start fill:#e1f5ff
    style Done fill:#51cf66
    style Review fill:#ffd43b
```

#### 3. ç”Ÿæˆçš„æ ¸å¿ƒä»£ç ç¤ºä¾‹

```java
@RestController
@RequestMapping("/api/auth")
@Validated
public class LoginController {
    @Autowired
    private LoginService loginService;
    
    @PostMapping("/login")
    public ResponseEntity<LoginResponse> login(
            @Valid @RequestBody LoginRequest request) {
        LoginResponse response = loginService.authenticate(
            request.getUsername(), 
            request.getPassword(),
            request.isRememberMe()
        );
        return ResponseEntity.ok(response);
    }
}

@Service
public class LoginService {
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private JwtTokenProvider tokenProvider;
    
    public LoginResponse authenticate(String username, 
                                     String password, 
                                     boolean rememberMe) {
        // æŸ¥æ‰¾å¹¶éªŒè¯ç”¨æˆ·
        User user = userRepository.findByUsername(username)
            .orElseThrow(() -> new BadCredentialsException("ç”¨æˆ·ä¸å­˜åœ¨"));
        
        if (!passwordEncoder.matches(password, user.getPassword())) {
            throw new BadCredentialsException("å¯†ç é”™è¯¯");
        }
        
        // ç”ŸæˆToken
        long expiration = rememberMe ? 30 * 24 * 60 * 60 : 24 * 60 * 60;
        String token = tokenProvider.generateToken(user, expiration);
        
        return LoginResponse.builder()
            .token(token)
            .username(user.getUsername())
            .expiresIn(expiration)
            .build();
    }
}
```

---

## æ‰©å±•ä¸ä¼˜åŒ–

### 1. æ’ä»¶æœºåˆ¶

```java
public interface DevAssistPlugin {
    String getId();
    String getName();
    void initialize(PluginContext context);
    PluginResult execute(PluginRequest request);
}

@Component
public class CustomFormatterPlugin implements DevAssistPlugin {
    @Override
    public PluginResult execute(PluginRequest request) {
        String code = request.getCode();
        String formatted = customFormat(code);
        return PluginResult.success(formatted);
    }
}
```

### 2. æŒç»­å­¦ä¹ æœºåˆ¶

```java
@Service
public class LearningService {
    @Autowired
    private FeedbackRepository feedbackRepository;
    
    // ä»ç”¨æˆ·åé¦ˆå­¦ä¹ 
    public void learnFromFeedback(TaskResult result, UserFeedback feedback) {
        if (feedback.getRating() >= 4) {
            savePositiveExample(result);
        } else {
            analyzeProblem(result, feedback);
            optimizeAgent(result.getAgentId());
        }
    }
    
    // å®šæœŸä¼˜åŒ–æç¤ºè¯
    @Scheduled(cron = "0 0 2 * * ?")
    public void optimizePrompts() {
        List<PromptTemplate> templates = getAllPrompts();
        templates.stream()
                .filter(t -> t.getPerformance() < 0.8)
                .forEach(this::improvePrompt);
    }
}
```

---

## éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  devassist-backend:
    image: devassist/backend:latest
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - LLM_API_KEY=${LLM_API_KEY}
    depends_on:
      - postgres
      - redis
      - rabbitmq
  
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=devassist
  
  redis:
    image: redis:7-alpine
  
  rabbitmq:
    image: rabbitmq:3-management
```

---

## æœ¬ç« æ€»ç»“

é€šè¿‡è¿™ä¸ªç»¼åˆé¡¹ç›®,æˆ‘ä»¬ï¼š
- âœ… æ•´åˆäº†å¤šç§åä½œæ¨¡å¼å’Œä¸“ä¸šæ™ºèƒ½ä½“
- âœ… å®ç°äº†å®Œæ•´çš„å¼€å‘è¾…åŠ©å¹³å°
- âœ… æŒæ¡äº†å¤æ‚ç³»ç»Ÿçš„æ¶æ„è®¾è®¡
- âœ… ç§¯ç´¯äº†Javaå·¥ç¨‹å®è·µç»éªŒ

**æœ€é‡è¦çš„æ˜¯**,æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•å°†æŠ€æœ¯è½åœ°,æ„å»ºçœŸæ­£æœ‰ä»·å€¼çš„AIåº”ç”¨ã€‚

---

**æ­å–œä½ å®Œæˆç¬¬18ç« ï¼** ğŸ‰

**ç»§ç»­å‰è¿›**ï¼š
- ğŸ“š å¤ä¹ æœ¬ç« çŸ¥è¯†ç‚¹
- ğŸ’» åŠ¨æ‰‹å®ç°è‡ªå·±çš„é¡¹ç›®
- ğŸŒŸ æ¢ç´¢æ›´å¤šå¯èƒ½æ€§

**å‚è€ƒèµ„æº**ï¼š
- TinyAIå®Œæ•´æºç ï¼š`tinyai-agent-multi`æ¨¡å—
- Spring Bootå®˜æ–¹æ–‡æ¡£
- LangChain4jé¡¹ç›®
