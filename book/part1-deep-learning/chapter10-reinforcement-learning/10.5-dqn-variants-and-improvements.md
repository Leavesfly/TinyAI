# 10.5 DQNå˜ä½“å’Œæ”¹è¿›: è®©ç®—æ³•æ›´å¼ºå¤§

> **æœ¬èŠ‚å­¦ä¹ ç›®æ ‡**: æŒæ¡DQNçš„ä¸»è¦æ”¹è¿›ç‰ˆæœ¬,ç†è§£Double DQNã€Dueling DQNã€ä¼˜å…ˆç»éªŒå›æ”¾ç­‰å…ˆè¿›æŠ€æœ¯çš„åŸç†å’Œåº”ç”¨

## å†…å®¹æ¦‚è§ˆ

DQNè™½ç„¶å¼ºå¤§,ä½†ç ”ç©¶è€…ä»¬å‘ç°äº†å®ƒçš„ä¸€äº›é—®é¢˜å¹¶æå‡ºäº†æ”¹è¿›æ–¹æ¡ˆã€‚æœ¬èŠ‚æˆ‘ä»¬å°†å­¦ä¹ DQNçš„"å‡çº§ç‰ˆæœ¬",å°±åƒæ‰‹æœºä»iPhone 1å‡çº§åˆ°iPhone 15,æ¯ä¸€ä»£éƒ½æœ‰æ–°ç‰¹æ€§!

## 10.5.1 DQNçš„é—®é¢˜ä¸æ”¹è¿›è·¯çº¿

### DQNå­˜åœ¨çš„ä¸»è¦é—®é¢˜

```mermaid
graph TB
    Problems[DQNçš„é—®é¢˜]
    
    Problems --> P1[Qå€¼è¿‡ä¼°è®¡<br/>Overestimation]
    Problems --> P2[å­¦ä¹ æ•ˆç‡ä½<br/>æ‰€æœ‰ç»éªŒåŒç­‰å¯¹å¾…]
    Problems --> P3[çŠ¶æ€ä»·å€¼ä¸ä¼˜åŠ¿<br/>æœªåˆ†ç¦»]
    
    P1 --> S1[â†’ Double DQN]
    P2 --> S2[â†’ Prioritized Replay]
    P3 --> S3[â†’ Dueling DQN]
    
    style Problems fill:#ffebee
    style P1 fill:#ffccbc
    style P2 fill:#ffe0b2
    style P3 fill:#fff9c4
    style S1 fill:#c8e6c9
    style S2 fill:#c8e6c9
    style S3 fill:#c8e6c9
```

### æ”¹è¿›æŠ€æœ¯æ¼”è¿›å›¾

```mermaid
graph LR
    DQN[DQN<br/>2013] --> DDQN[Double DQN<br/>2015]
    DQN --> Dueling[Dueling DQN<br/>2016]
    DQN --> PER[Prioritized Replay<br/>2016]
    
    DDQN --> Rainbow[Rainbow DQN<br/>2017<br/>é›†å¤§æˆè€…]
    Dueling --> Rainbow
    PER --> Rainbow
    
    style DQN fill:#bbdefb
    style DDQN fill:#c5e1a5
    style Dueling fill:#ffe0b2
    style PER fill:#f8bbd0
    style Rainbow fill:#ffd54f
```

## 10.5.2 Double DQN: è§£å†³Qå€¼è¿‡ä¼°è®¡

### ä»€ä¹ˆæ˜¯Qå€¼è¿‡ä¼°è®¡?

**ç”Ÿæ´»ç±»æ¯”**: ç›²ç›®ä¹è§‚çš„æŠ•èµ„è€…

æƒ³è±¡ä½ åœ¨é€‰è‚¡ç¥¨æŠ•èµ„:
- **DQNçš„åšæ³•**: "æˆ‘è§‰å¾—Aè‚¡ç¥¨æœ€å¥½,è€Œä¸”æˆ‘ä¼°è®¡å®ƒèƒ½æ¶¨åˆ°100å…ƒ!" (è‡ªå·±é€‰æ‹©+è‡ªå·±è¯„ä¼°)
- **é—®é¢˜**: å€¾å‘äºé«˜ä¼°è‡ªå·±çœ‹å¥½çš„è‚¡ç¥¨

```mermaid
graph TB
    subgraph DQNæ ‡å‡†æ–¹æ³•
        D1[é€‰æœ€ä¼˜åŠ¨ä½œ] --> D2[ç”¨åŒä¸€ä¸ªç½‘ç»œè¯„ä¼°]
        D2 --> D3[å®¹æ˜“é«˜ä¼°]
    end
    
    subgraph Double DQNæ”¹è¿›
        DD1[ä¸»ç½‘ç»œé€‰æ‹©åŠ¨ä½œ] --> DD2[ç›®æ ‡ç½‘ç»œè¯„ä¼°ä»·å€¼]
        DD2 --> DD3[æ›´å®¢è§‚å‡†ç¡®]
    end
    
    style D3 fill:#ffccbc
    style DD3 fill:#c8e6c9
```

### æ ¸å¿ƒæ€æƒ³: é€‰æ‹©ä¸è¯„ä¼°åˆ†ç¦»

**å…³é”®æ”¹å˜**: ç”¨ä¸»ç½‘ç»œé€‰åŠ¨ä½œ,ç”¨ç›®æ ‡ç½‘ç»œè¯„ä¼°ä»·å€¼

```mermaid
graph LR
    State[çŠ¶æ€s'] --> Main[ä¸»ç½‘ç»œ<br/>é€‰æ‹©æœ€ä¼˜åŠ¨ä½œa*]
    Main --> Target[ç›®æ ‡ç½‘ç»œ<br/>è¯„ä¼°Qå€¼s',a*]
    Target --> Value[å¾—åˆ°ç›®æ ‡Qå€¼]
    
    style Main fill:#bbdefb
    style Target fill:#c5e1a5
    style Value fill:#ffe0b2
```

### å…¬å¼å¯¹æ¯”

**æ ‡å‡†DQN**:
```
ç›®æ ‡ = r + Î³ max_a' Q(s', a'; Î¸â»)
         â””â”€ é€‰æ‹©å’Œè¯„ä¼°éƒ½ç”¨Î¸â»
```

**Double DQN**:
```
a* = argmax_a' Q(s', a'; Î¸)  â† ä¸»ç½‘ç»œé€‰æ‹©
ç›®æ ‡ = r + Î³ Q(s', a*; Î¸â»)    â† ç›®æ ‡ç½‘ç»œè¯„ä¼°
```

**ç™½è¯ç¿»è¯‘**:
- DQN: è‡ªå·±é€‰æ‹©å¹¶å¤¸è‡ªå·±
- Double DQN: è‡ªå·±é€‰æ‹©,è®©åˆ«äººè¯„ä»·

### ä»£ç å®ç°

```java
/**
 * Double DQNå®ç°
 */
public class DoubleDQN extends DQN {
    
    /**
     * è®¡ç®—ç›®æ ‡Qå€¼(Double DQNæ–¹å¼)
     */
    @Override
    protected double computeTargetQ(Experience exp) {
        if (exp.done) {
            return exp.reward;
        }
        
        // 1. ä¸»ç½‘ç»œé€‰æ‹©æœ€ä¼˜åŠ¨ä½œ
        double[] mainQ = mainNetwork.predict(exp.nextState);
        int bestAction = argmax(mainQ);
        
        // 2. ç›®æ ‡ç½‘ç»œè¯„ä¼°è¯¥åŠ¨ä½œçš„ä»·å€¼
        double[] targetQ = targetNetwork.predict(exp.nextState);
        double nextValue = targetQ[bestAction];
        
        return exp.reward + gamma * nextValue;
    }
}
```

### æ•ˆæœå¯¹æ¯”

```mermaid
graph LR
    Compare[æ€§èƒ½å¯¹æ¯”]
    
    Compare --> DQN[æ ‡å‡†DQN<br/>å¹³å‡Qå€¼: è¿‡é«˜]
    Compare --> DDQN[Double DQN<br/>å¹³å‡Qå€¼: å‡†ç¡®]
    
    DQN --> R1[æœ€ç»ˆè¡¨ç°: 85åˆ†]
    DDQN --> R2[æœ€ç»ˆè¡¨ç°: 92åˆ†]
    
    style DQN fill:#ffe0b2
    style DDQN fill:#c8e6c9
    style R1 fill:#ffccbc
    style R2 fill:#81c784
```

## 10.5.3 Dueling DQN: åˆ†ç¦»çŠ¶æ€ä»·å€¼å’Œä¼˜åŠ¿

### æ ¸å¿ƒæ´å¯Ÿ: ä¸æ˜¯æ‰€æœ‰åŠ¨ä½œéƒ½é‡è¦

**ç”Ÿæ´»ä¾‹å­**: å¼€è½¦çš„å†³ç­–

```mermaid
graph TB
    Situation[æƒ…å†µ: åœ¨é«˜é€Ÿå…¬è·¯ä¸Š]
    
    Situation --> V[çŠ¶æ€ä»·å€¼V<br/>è¿™ä¸ªä½ç½®æœ¬èº«å¥½ä¸å¥½]
    Situation --> A[ä¼˜åŠ¿å‡½æ•°A<br/>ä¸åŒåŠ¨ä½œçš„ç›¸å¯¹å¥½å]
    
    V --> V1[é«˜é€Ÿè·¯å†µ: ä»·å€¼é«˜<br/>æ— è®ºåšä»€ä¹ˆåŠ¨ä½œ]
    A --> A1[ç›´è¡Œ: ä¼˜åŠ¿ +0.5]
    A --> A2[å˜é“: ä¼˜åŠ¿ +0.2]
    A --> A3[æ€¥åˆ¹: ä¼˜åŠ¿ -10]
    
    style Situation fill:#e1bee7
    style V fill:#bbdefb
    style A fill:#c5e1a5
    style V1 fill:#e3f2fd
    style A3 fill:#ffccbc
```

**å…³é”®æ€æƒ³**: 
- **V(s)**: è¿™ä¸ªçŠ¶æ€æœ¬èº«æœ‰å¤šå¥½
- **A(s,a)**: åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹,æŸä¸ªåŠ¨ä½œæ¯”å¹³å‡å¥½å¤šå°‘

### Qå€¼çš„åˆ†è§£

```
Q(s,a) = V(s) + A(s,a)
```

**å½¢è±¡ç†è§£**:
```
åŠ¨ä½œæ€»åˆ† = çŠ¶æ€åŸºç¡€åˆ† + åŠ¨ä½œé¢å¤–åˆ†
```

### ç½‘ç»œæ¶æ„å¯¹æ¯”

```mermaid
graph TB
    subgraph æ ‡å‡†DQN
        S1[çŠ¶æ€è¾“å…¥] --> H1[å…±äº«å±‚]
        H1 --> Q1[Qå€¼è¾“å‡º<br/>æ¯ä¸ªåŠ¨ä½œä¸€ä¸ªQå€¼]
    end
    
    subgraph Dueling DQN
        S2[çŠ¶æ€è¾“å…¥] --> H2[å…±äº«å±‚]
        H2 --> V[ä»·å€¼æµ<br/>è¾“å‡ºVå€¼s]
        H2 --> A[ä¼˜åŠ¿æµ<br/>è¾“å‡ºAå€¼s,a]
        V --> Combine[ç»„åˆå±‚<br/>Q = V + A]
        A --> Combine
        Combine --> Q2[Qå€¼è¾“å‡º]
    end
    
    style Q1 fill:#ffe0b2
    style Combine fill:#c8e6c9
```

### å®é™…ç½‘ç»œç»“æ„

```
è¾“å…¥å±‚: [84Ã—84Ã—4]
   â†“
å·ç§¯å±‚ (å…±äº«ç‰¹å¾æå–)
   â†“
  / \
 /   \
Væµ  Aæµ
â”‚    â”‚
â”‚    â””â†’ å…¨è¿æ¥ â†’ [åŠ¨ä½œæ•°]
â””â”€â”€â”€â”€â†’ å…¨è¿æ¥ â†’ [1]
       \      /
        \    /
    ç»„åˆ: Q = V + (A - mean(A))
           â†“
        Qå€¼è¾“å‡º
```

**ä¸ºä»€ä¹ˆè¦å‡å»mean(A)?** 
- ä¿è¯å¯è¯†åˆ«æ€§: Vå’ŒAçš„åˆ†è§£æ˜¯å”¯ä¸€çš„
- **ç±»æ¯”**: è€ƒè¯•æˆç»© = ç­çº§å¹³å‡åˆ† + ä¸ªäººä¸å¹³å‡çš„å·®è·

### ä»£ç å®ç°

```java
/**
 * Dueling DQNç½‘ç»œ
 */
public class DuelingNetwork {
    private ConvLayers sharedLayers;  // å…±äº«å·ç§¯å±‚
    private DenseLayer valueStream;   // ä»·å€¼æµ
    private DenseLayer advantageStream; // ä¼˜åŠ¿æµ
    
    /**
     * å‰å‘ä¼ æ’­
     */
    public double[] forward(double[] state) {
        // 1. å…±äº«ç‰¹å¾æå–
        double[] features = sharedLayers.forward(state);
        
        // 2. è®¡ç®—çŠ¶æ€ä»·å€¼V(s)
        double value = valueStream.forward(features)[0];
        
        // 3. è®¡ç®—ä¼˜åŠ¿å‡½æ•°A(s,a)
        double[] advantages = advantageStream.forward(features);
        
        // 4. ç»„åˆå¾—åˆ°Qå€¼
        double meanAdvantage = mean(advantages);
        double[] qValues = new double[advantages.length];
        
        for (int a = 0; a < advantages.length; a++) {
            qValues[a] = value + (advantages[a] - meanAdvantage);
        }
        
        return qValues;
    }
}
```

### ä¼˜åŠ¿ä½“ç°

âœ… **æ›´å¥½çš„çŠ¶æ€ä»·å€¼ä¼°è®¡**: å³ä½¿åŠ¨ä½œé€‰æ‹©ä¸ä½³,V(s)ä¹Ÿèƒ½å­¦å¥½  
âœ… **æ›´å¿«çš„å­¦ä¹ é€Ÿåº¦**: åˆ†ç¦»å­¦ä¹ ,äº’ä¸å¹²æ‰°  
âœ… **æ›´é²æ£’**: åœ¨åŠ¨ä½œä»·å€¼ç›¸è¿‘æ—¶è¡¨ç°æ›´å¥½

```mermaid
graph LR
    Comparison[Dueling vs æ ‡å‡†DQN]
    
    Comparison --> Speed[å­¦ä¹ é€Ÿåº¦<br/>å¿«20-30%]
    Comparison --> Stability[ç¨³å®šæ€§<br/>æå‡æ˜æ˜¾]
    Comparison --> Performance[æœ€ç»ˆè¡¨ç°<br/>æå‡5-10%]
    
    style Comparison fill:#e1bee7
    style Speed fill:#c8e6c9
    style Stability fill:#c8e6c9
    style Performance fill:#c8e6c9
```

## 10.5.4 ä¼˜å…ˆç»éªŒå›æ”¾(Prioritized Experience Replay)

### æ ‡å‡†ç»éªŒå›æ”¾çš„é—®é¢˜

**ç”Ÿæ´»ç±»æ¯”**: é”™é¢˜æœ¬çš„ä½¿ç”¨

```mermaid
graph TB
    subgraph æ™®é€šå¤ä¹ 
        N1[éšæœºç¿»çœ‹é”™é¢˜] --> N2[ç®€å•é¢˜å’Œéš¾é¢˜<br/>èŠ±åŒæ ·æ—¶é—´]
        N2 --> N3[æ•ˆç‡ä¸€èˆ¬]
    end
    
    subgraph ä¼˜å…ˆå¤ä¹ 
        P1[é‡ç‚¹çœ‹éš¾é¢˜] --> P2[é”™å¾—å¤šçš„é¢˜<br/>å¤šçœ‹å‡ é]
        P2 --> P3[æ•ˆç‡æ›´é«˜]
    end
    
    style N3 fill:#ffe0b2
    style P3 fill:#c8e6c9
```

### æ ¸å¿ƒæ€æƒ³: é‡è¦çš„ç»éªŒå¤šå­¦å‡ æ¬¡

ä¸æ˜¯æ‰€æœ‰ç»éªŒéƒ½åŒç­‰é‡è¦!
- **TDè¯¯å·®å¤§**: è¯´æ˜è¿™ä¸ªç»éªŒ"æ„å¤–",å€¼å¾—å¤šå­¦
- **TDè¯¯å·®å°**: è¯´æ˜å·²ç»å­¦ä¼šäº†,å¯ä»¥å°‘çœ‹

```mermaid
graph LR
    Exp1[ç»éªŒ1<br/>TDè¯¯å·®=0.1<br/>ä¼˜å…ˆçº§:ä½] -.ä½æ¦‚ç‡é‡‡æ ·.-> Sample
    Exp2[ç»éªŒ2<br/>TDè¯¯å·®=2.5<br/>ä¼˜å…ˆçº§:é«˜] -.é«˜æ¦‚ç‡é‡‡æ ·.-> Sample
    Exp3[ç»éªŒ3<br/>TDè¯¯å·®=0.3<br/>ä¼˜å…ˆçº§:ä½] -.ä½æ¦‚ç‡é‡‡æ ·.-> Sample
    Exp4[ç»éªŒ4<br/>TDè¯¯å·®=1.8<br/>ä¼˜å…ˆçº§:ä¸­] -.ä¸­æ¦‚ç‡é‡‡æ ·.-> Sample
    
    Sample[é‡‡æ ·è¿‡ç¨‹] --> Train[è®­ç»ƒ]
    
    style Exp2 fill:#ff8a65
    style Exp4 fill:#ffb74d
    style Exp1 fill:#fff9c4
    style Exp3 fill:#fff9c4
    style Train fill:#c8e6c9
```

### ä¼˜å…ˆçº§è®¡ç®—

**æ–¹æ³•1: åŸºäºTDè¯¯å·®**
```
ä¼˜å…ˆçº§ = |TDè¯¯å·®| + Îµ
       = |r + Î³ max Q(s',a') - Q(s,a)| + Îµ
```
Îµæ˜¯å°å¸¸æ•°,é˜²æ­¢æŸäº›ç»éªŒæ°¸è¿œä¸è¢«é‡‡æ ·

**æ–¹æ³•2: åŸºäºTDè¯¯å·®çš„Î±æ¬¡æ–¹**
```
ä¼˜å…ˆçº§ = (|TDè¯¯å·®| + Îµ)^Î±
```
Î±æ§åˆ¶ä¼˜å…ˆçº§çš„å¼ºåº¦(é€šå¸¸0.6-0.7)

### é‡‡æ ·æ¦‚ç‡

```
é‡‡æ ·æ¦‚ç‡ P(i) = (ä¼˜å…ˆçº§_i)^Î² / Î£(ä¼˜å…ˆçº§_j)^Î²
```

Î²æ§åˆ¶ä¼˜å…ˆçº§çš„ä½¿ç”¨ç¨‹åº¦:
- Î²=0: å‡åŒ€é‡‡æ ·(é€€åŒ–ä¸ºæ ‡å‡†ç»éªŒå›æ”¾)
- Î²=1: å®Œå…¨æŒ‰ä¼˜å…ˆçº§é‡‡æ ·

### ä»£ç å®ç°(ç®€åŒ–ç‰ˆ)

```java
/**
 * ä¼˜å…ˆç»éªŒå›æ”¾ç¼“å†²åŒº
 */
public class PrioritizedReplayBuffer {
    private List<Experience> buffer;
    private double[] priorities;  // ä¼˜å…ˆçº§
    private double alpha = 0.6;   // ä¼˜å…ˆçº§æŒ‡æ•°
    private double beta = 0.4;    // é‡è¦æ€§é‡‡æ ·æŒ‡æ•°
    
    /**
     * å­˜å‚¨ç»éªŒ(å¸¦åˆå§‹ä¼˜å…ˆçº§)
     */
    public void store(Experience exp, double tdError) {
        buffer.add(exp);
        
        // è®¡ç®—ä¼˜å…ˆçº§
        double priority = Math.pow(Math.abs(tdError) + 1e-5, alpha);
        priorities[buffer.size() - 1] = priority;
    }
    
    /**
     * æŒ‰ä¼˜å…ˆçº§é‡‡æ ·
     */
    public List<Experience> sample(int batchSize) {
        // 1. è®¡ç®—é‡‡æ ·æ¦‚ç‡
        double[] probs = computeSamplingProbs();
        
        // 2. æŒ‰æ¦‚ç‡é‡‡æ ·
        List<Experience> batch = new ArrayList<>();
        for (int i = 0; i < batchSize; i++) {
            int idx = sampleIndex(probs);
            batch.add(buffer.get(idx));
        }
        
        return batch;
    }
    
    /**
     * æ›´æ–°ç»éªŒçš„ä¼˜å…ˆçº§
     */
    public void updatePriority(int idx, double newTdError) {
        priorities[idx] = Math.pow(Math.abs(newTdError) + 1e-5, alpha);
    }
    
    /**
     * è®¡ç®—é‡‡æ ·æ¦‚ç‡
     */
    private double[] computeSamplingProbs() {
        double sum = 0;
        for (double p : priorities) {
            sum += Math.pow(p, beta);
        }
        
        double[] probs = new double[priorities.length];
        for (int i = 0; i < priorities.length; i++) {
            probs[i] = Math.pow(priorities[i], beta) / sum;
        }
        
        return probs;
    }
}
```

### é‡è¦æ€§é‡‡æ ·æ ¡æ­£

å› ä¸ºæ”¹å˜äº†é‡‡æ ·åˆ†å¸ƒ,éœ€è¦æ ¡æ­£åå·®:

```
æƒé‡ w_i = (1 / (N Ã— P(i)))^Î²
```

è®­ç»ƒæ—¶ç”¨è¿™ä¸ªæƒé‡è°ƒæ•´æ¢¯åº¦

### æ•ˆæœæå‡

```mermaid
graph TB
    Results[ä¼˜å…ˆç»éªŒå›æ”¾æ•ˆæœ]
    
    Results --> R1[å­¦ä¹ é€Ÿåº¦<br/>æå‡2-3å€]
    Results --> R2[æ ·æœ¬æ•ˆç‡<br/>æ˜¾è‘—æé«˜]
    Results --> R3[æœ€ç»ˆæ€§èƒ½<br/>æå‡10-15%]
    
    style Results fill:#e1bee7
    style R1 fill:#81c784
    style R2 fill:#81c784
    style R3 fill:#81c784
```

## 10.5.5 å…¶ä»–é‡è¦æ”¹è¿›

### Næ­¥å­¦ä¹ (Multi-step Learning)

**æ€æƒ³**: çœ‹æœªæ¥Næ­¥,è€Œä¸åªæ˜¯1æ­¥

```mermaid
graph LR
    S[çŠ¶æ€s] --> S1[1æ­¥åsâ‚]
    S1 --> S2[2æ­¥åsâ‚‚]
    S2 --> S3[Næ­¥åsâ‚™]
    
    S -.1æ­¥å›æŠ¥.-> R1[râ‚ + Î³Vâ‚]
    S -.Næ­¥å›æŠ¥.-> RN[râ‚+Î³râ‚‚+...+Î³â¿Vâ‚™]
    
    style RN fill:#c8e6c9
```

**ä¼˜åŠ¿**: å¹³è¡¡åå·®å’Œæ–¹å·®,åŠ é€Ÿå­¦ä¹ 

### Noisy Networks

**æ€æƒ³**: åœ¨ç½‘ç»œå‚æ•°ä¸­åŠ å…¥å™ªå£°,æ›¿ä»£Îµ-è´ªå¿ƒæ¢ç´¢

```java
// å™ªå£°æƒé‡
W = Î¼ + Ïƒ âŠ™ Îµ
```

**ä¼˜åŠ¿**: 
- çŠ¶æ€ç›¸å…³çš„æ¢ç´¢
- æ›´æ™ºèƒ½çš„æ¢ç´¢ç­–ç•¥

### åˆ†å¸ƒå¼DQN(Categorical DQN)

**æ€æƒ³**: ä¸å­¦ä¹ Qå€¼çš„æœŸæœ›,è€Œæ˜¯å­¦ä¹ Qå€¼çš„åˆ†å¸ƒ

```mermaid
graph LR
    State[çŠ¶æ€] --> Network[ç½‘ç»œ]
    Network --> Dist[Qå€¼åˆ†å¸ƒ<br/>ä¸æ˜¯å•ä¸ªå€¼]
    
    Dist --> Low[æ‚²è§‚æƒ…å†µ: Q=5]
    Dist --> Mid[ä¸­ç­‰æƒ…å†µ: Q=10]
    Dist --> High[ä¹è§‚æƒ…å†µ: Q=15]
    
    style Dist fill:#e1bee7
    style Mid fill:#c8e6c9
```

**ä¼˜åŠ¿**: æ›´ä¸°å¯Œçš„ä»·å€¼è¡¨ç¤º,æ›´é²æ£’

## 10.5.6 Rainbow DQN: é›†å¤§æˆè€…

### ç»„åˆå¤šç§æ”¹è¿›

Rainbowå°†6ç§æ”¹è¿›æŠ€æœ¯ç»“åˆ:

```mermaid
graph TB
    Rainbow[Rainbow DQN]
    
    Rainbow --> T1[Double DQN<br/>å‡å°‘è¿‡ä¼°è®¡]
    Rainbow --> T2[Dueling DQN<br/>åˆ†ç¦»Vå’ŒA]
    Rainbow --> T3[Prioritized Replay<br/>ä¼˜å…ˆé‡‡æ ·]
    Rainbow --> T4[Multi-step<br/>Næ­¥å­¦ä¹ ]
    Rainbow --> T5[Noisy Nets<br/>å‚æ•°å™ªå£°]
    Rainbow --> T6[Categorical DQN<br/>åˆ†å¸ƒå¼RL]
    
    style Rainbow fill:#ffd54f
    style T1 fill:#81c784
    style T2 fill:#81c784
    style T3 fill:#81c784
    style T4 fill:#81c784
    style T5 fill:#81c784
    style T6 fill:#81c784
```

### æ€§èƒ½å¯¹æ¯”

```mermaid
graph LR
    Baseline[DQNåŸºçº¿<br/>100%] --> DDQN[+Double<br/>110%]
    DDQN --> Dueling[+Dueling<br/>125%]
    Dueling --> PER[+PER<br/>150%]
    PER --> Rainbow[Rainbowå…¨å®¶æ¡¶<br/>180%]
    
    style Baseline fill:#ffe0b2
    style DDQN fill:#fff9c4
    style Dueling fill:#c5e1a5
    style PER fill:#81c784
    style Rainbow fill:#ffd54f
```

### å®ç°å»ºè®®

```java
/**
 * Rainbow DQN (æ¦‚å¿µæ€§å®ç°)
 */
public class RainbowDQN {
    private DuelingNetwork network;        // Duelingæ¶æ„
    private PrioritizedReplayBuffer buffer; // ä¼˜å…ˆç»éªŒå›æ”¾
    private int nStep = 3;                 // 3æ­¥å­¦ä¹ 
    
    /**
     * è®­ç»ƒä¸€æ‰¹æ•°æ®
     */
    public void train() {
        // 1. ä¼˜å…ˆé‡‡æ ·
        List<Experience> batch = buffer.sample(batchSize);
        
        for (Experience exp : batch) {
            // 2. è®¡ç®—Næ­¥å›æŠ¥
            double nStepReturn = computeNStepReturn(exp);
            
            // 3. Double DQNç›®æ ‡
            int bestAction = network.getBestAction(exp.nextState);
            double targetQ = targetNetwork.getQValue(exp.nextState, bestAction);
            
            // 4. æ›´æ–°ç½‘ç»œ
            double tdError = nStepReturn + gamma * targetQ - currentQ;
            network.update(tdError);
            
            // 5. æ›´æ–°ä¼˜å…ˆçº§
            buffer.updatePriority(exp.idx, tdError);
        }
    }
}
```

## 10.5.7 å„æ”¹è¿›æŠ€æœ¯å¯¹æ¯”

### æ€§èƒ½æå‡å¯¹æ¯”è¡¨

| æŠ€æœ¯ | è®­ç»ƒé€Ÿåº¦ | æœ€ç»ˆæ€§èƒ½ | ç¨³å®šæ€§ | å®ç°éš¾åº¦ |
|------|---------|---------|--------|----------|
| Double DQN | â†‘10% | â†‘5-10% | â†‘â†‘ | â­ |
| Dueling DQN | â†‘20% | â†‘8-12% | â†‘ | â­â­ |
| Prioritized Replay | â†‘100% | â†‘10-15% | â†‘â†‘ | â­â­â­ |
| Multi-step | â†‘30% | â†‘5-8% | â†‘ | â­â­ |
| Rainbow (å…¨éƒ¨) | â†‘150% | â†‘50-80% | â†‘â†‘â†‘ | â­â­â­â­ |

### åº”ç”¨åœºæ™¯å»ºè®®

```mermaid
graph TB
    Choose[å¦‚ä½•é€‰æ‹©DQNå˜ä½“?]
    
    Choose --> S1[è¿½æ±‚ç®€å•<br/>â†’ Double DQN]
    Choose --> S2[è¿½æ±‚æ€§èƒ½<br/>â†’ Rainbow DQN]
    Choose --> S3[æ ·æœ¬æœ‰é™<br/>â†’ Prioritized Replay]
    Choose --> S4[ç¦»çº¿å­¦ä¹ <br/>â†’ Multi-step]
    
    style Choose fill:#e1bee7
    style S1 fill:#c8e6c9
    style S2 fill:#ffd54f
    style S3 fill:#81c784
    style S4 fill:#bbdefb
```

## æœ¬èŠ‚å°ç»“

### æ”¹è¿›æŠ€æœ¯å›¾è°±

```mermaid
graph TB
    Root[DQNæ”¹è¿›æŠ€æœ¯]
    
    Root --> Cat1[è§£å†³è¿‡ä¼°è®¡]
    Root --> Cat2[æå‡æ•ˆç‡]
    Root --> Cat3[æ”¹è¿›æ¶æ„]
    
    Cat1 --> C11[Double DQN<br/>é€‰æ‹©è¯„ä¼°åˆ†ç¦»]
    
    Cat2 --> C21[Prioritized Replay<br/>ä¼˜å…ˆé‡è¦ç»éªŒ]
    Cat2 --> C22[Multi-step<br/>å¤šæ­¥å›æŠ¥]
    
    Cat3 --> C31[Dueling DQN<br/>Vå’ŒAåˆ†ç¦»]
    Cat3 --> C32[Noisy Nets<br/>å‚æ•°å™ªå£°æ¢ç´¢]
    Cat3 --> C33[Categorical DQN<br/>åˆ†å¸ƒå¼ä»·å€¼]
    
    C11 & C21 & C22 & C31 & C32 & C33 --> Rainbow[Rainbow DQN]
    
    style Root fill:#e1bee7
    style Cat1 fill:#ffccbc
    style Cat2 fill:#c5e1a5
    style Cat3 fill:#bbdefb
    style Rainbow fill:#ffd54f
```

### æ ¸å¿ƒè¦ç‚¹

1. **Double DQN**: ç”¨åŒç½‘ç»œè§£å†³Qå€¼è¿‡ä¼°è®¡,ç®€å•æœ‰æ•ˆ
2. **Dueling DQN**: åˆ†ç¦»çŠ¶æ€ä»·å€¼å’Œä¼˜åŠ¿å‡½æ•°,å­¦ä¹ æ›´é«˜æ•ˆ
3. **ä¼˜å…ˆç»éªŒå›æ”¾**: é‡è¦ç»éªŒå¤šå­¦ä¹ ,æ ·æœ¬æ•ˆç‡å¤§å¹…æå‡
4. **Rainbow DQN**: ç»„åˆå¤šç§æŠ€æœ¯,è¾¾åˆ°æœ€ä½³æ€§èƒ½
5. **é€‰æ‹©ç­–ç•¥**: æ ¹æ®éœ€æ±‚æƒè¡¡æ€§èƒ½å’Œå¤æ‚åº¦

### å®è·µå»ºè®®

ğŸ’¡ **å¾ªåºæ¸è¿›**: å…ˆå®ç°Double DQN,å†é€æ­¥åŠ å…¥å…¶ä»–æŠ€æœ¯  
ğŸ’¡ **é‡ç‚¹ä¼˜åŒ–**: Prioritized Replayæå‡æœ€æ˜æ˜¾,ä¼˜å…ˆè€ƒè™‘  
ğŸ’¡ **æƒè¡¡å¤æ‚åº¦**: Rainbowå¾ˆå¼ºä½†å¤æ‚,ç®€å•ä»»åŠ¡ä¸å¿…è¦  
ğŸ’¡ **è°ƒè¯•æŠ€å·§**: æ¯åŠ ä¸€ä¸ªæ”¹è¿›éƒ½è¦éªŒè¯æ•ˆæœ

### ç”Ÿæ´»å¯ç¤º

DQNçš„æ”¹è¿›å†ç¨‹å‘Šè¯‰æˆ‘ä»¬:
- **ä¸“æ³¨æ ¸å¿ƒé—®é¢˜**: Double DQNé’ˆå¯¹æ€§è§£å†³è¿‡ä¼°è®¡
- **æ•ˆç‡è‡³ä¸Š**: ä¼˜å…ˆç»éªŒå›æ”¾æé«˜å­¦ä¹ æ•ˆç‡
- **åˆ†è€Œæ²»ä¹‹**: Dueling DQNåˆ†ç¦»å…³æ³¨ç‚¹
- **é›†æˆåˆ›æ–°**: Rainbowç»„åˆä¼˜åŠ¿

ä¸‹ä¸€èŠ‚,æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„CartPoleé¡¹ç›®,ç»¼åˆè¿ç”¨è¿™äº›æŠ€æœ¯!

---

**ç»ƒä¹ ä»»åŠ¡**:
1. ç”¨ä¼ªä»£ç å®ç°Double DQNçš„æ ¸å¿ƒé€»è¾‘
2. æ€è€ƒ: ä¸ºä»€ä¹ˆDueling DQNè¦å‡å»ä¼˜åŠ¿å‡½æ•°çš„å‡å€¼?
3. è®¾è®¡ä¸€ä¸ªå®éªŒ,å¯¹æ¯”æ ‡å‡†DQNå’Œä¼˜å…ˆç»éªŒå›æ”¾çš„æ•ˆæœ
